{"version":3,"sources":["../../../src/js/form.js"],"names":["$","widget","options","_create","_sourceUrl","element","attr","_required","autocomplete","select","proxy","_onSelect","source","_onSource","change","_onChange","_valuesContainer","addClass","insertAfter","on","_onValueRemoveClick","_loadValues","valuesAttr","values","JSON","parse","i","length","_addItem","value","label","_updateValues","append","appendTo","find","map","index","get","inputName","val","join","empty","setCustomValidity","event","preventDefault","target","closest","remove","ui","item","input","callback","sourceUrl","indexOf","term","items","_selected","_onFocus","undefined","_getInput","_originalValue","_originalLabel","attachedVisibleIfListeners","_onFormSubmit","Modernizr","formvalidation","hyperform","each","inputIndex","inputElement","removeAttr","bind","formGroupId","rule","_registerVisibleIfRule","_createDatePickers","_createTimePickers","_createDateTimePickers","_createAutocompleteFields","returnArray","serializeArray","serialize","submit","addData","key","dataInput","MetaformUtils","createDatePicker","createTimePicker","createDateTimePicker","metaformAutocomplete","metaformMultivalueAutocomplete","currentRule","field","push","_createFormChangeFunction","keyup","and","andSubRule","or","j","orSubRule","hide","_evaluateFormRule","equals","analyzed","first","currentValue","checked","is","andResult","orResult","e","formGroup","slideToggle","_onRequiredFieldsVisibilityChange","container","action","data","ajax","url","method","success","response","isFunction","onPostSuccess","bootbox","alert","message","backdrop","window","location","reload","error","jqXHR","textStatus","errorMessage","responseText","statusText","onPostError","text","document","body","tableRow","clone","_onAddtableRowClick","_onPrintTableClick","_onInputChange","_onEnumSelectChange","_refresh","html","row","_processTableRow","removeAllRows","addRow","_addRow","_refreshEnumSelect","clonedRow","columnName","datas","rowIndex","sum","columnIndex","column","parseFloat","indexRow","rowDatas","cell","_getCellValue","stringify","enumSelect","other","css","parent","columnType","option","_generatePrintableTable","tableHeaders","th","style","tableWidths","tableBody","tr","cellIndex","content","table","widths","styles","header","fontSize","bold","marginBottom","tableHeader","tableFooter","docDefinition","pdfMake","createPdf","download","_uploadUrl","_singleFile","_onlyImages","_maxFileSize","parseInt","_onAddFileButtonClick","_onRemoveFileButtonClick","fileUploadOptions","maxFileSize","dataType","add","_onUploadAdd","fail","_onUploadFail","done","_onUploadDone","progressall","_onProgressAll","acceptFileTypes","opacity","fileupload","show","removeClass","click","prop","notification","setTimeout","result","file","_id","fileData","originalname","filename","deleteKey","trigger","progress","loaded","total","button","fileId","res","ready","metaform","fileField","tableField","jQuery"],"mappings":"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","file":"form.js","sourcesContent":["/* global Modernizr, pdfMake, MetaformUtils, hyperform, bootbox */\n(function($) {\n  'use strict';\n  \n  $.widget(\"custom.metaformMultivalueAutocomplete\", {\n    options: {\n    },\n\n    _create : function() {\n      this._sourceUrl = this.element.attr('data-source-url');\n      this._required = !!this.element.attr('data-required');\n      \n      this.element.autocomplete({\n        select: $.proxy(this._onSelect, this),\n        source: $.proxy(this._onSource, this),\n        change: $.proxy(this._onChange, this)\n      });\n      \n      this._valuesContainer = $('<div>')\n        .addClass('metaform-multivalue-values')\n        .insertAfter(this.element);\n\n      this._valuesContainer.on('click', '.metaform-multivalue-autocomplete-delete', $.proxy(this._onValueRemoveClick, this));\n      \n      this._loadValues();\n    },\n    \n    _loadValues: function () {\n      var valuesAttr = this.element.attr('data-values');\n      if (valuesAttr) {\n        var values = JSON.parse(valuesAttr);\n        for (var i = 0; i < values.length; i++) {\n          this._addItem(values[i].value, values[i].label);\n        }\n        \n        this._updateValues();\n      }\n    },\n    \n    _addItem: function (value, label) {\n      $('<span>')\n        .addClass('metaform-multivalue-autocomplete-item')\n        .attr('data-value', value)\n        .attr('data-label', label)\n        .append($('<a>').attr('href', '#').addClass('fa fa-times metaform-multivalue-autocomplete-delete'))\n        .append('&nbsp;')\n        .append(label)\n        .appendTo(this._valuesContainer);\n    },\n    \n    _updateValues: function () {\n      const values = this._valuesContainer.find('.metaform-multivalue-autocomplete-item').map(function (index, element) {\n        return $(element).attr('data-value');\n      }).get();\n      \n      var inputName = this.element.attr('data-name');\n      $('input[name=\"' + inputName + '\"]').val(values.join(','));\n      \n      if (this._required) {\n        var empty = !$('input[name=\"' + inputName + '\"]').val();\n        this.element[0].setCustomValidity(empty ? 'This is a required field' : '');\n      }\n    },\n    \n    _onValueRemoveClick: function (event) {\n      event.preventDefault();\n      $(event.target)\n        .closest('.metaform-multivalue-autocomplete-item')\n        .remove();      \n\n      this._updateValues();\n    },\n      \n    _onSelect: function (event, ui) {\n      event.preventDefault();\n      var item = ui.item;\n      this.element.val('');\n      this._addItem(item.value, item.label);\n      this._updateValues();\n    },\n\n    _onSource: function (input, callback) {\n      var sourceUrl = this._sourceUrl + (this._sourceUrl.indexOf('?') === -1 ? '?q=' + input.term : '&q=' + input.term);\n      $.get(sourceUrl, function(items) {\n        callback($.map(items, function (item) {\n          return { \n            value: item.value,\n            label: item.label\n          }; \n        }));\n      }, \"json\");\n    },\n    \n    _onChange: function (input, callback) {\n      this.element.val('');\n    }\n  });\n  \n  $.widget(\"custom.metaformAutocomplete\", {\n    \n    _create : function() {\n      this._sourceUrl = this.element.attr('data-source-url');\n      this._selected = false;\n      \n      this.element.on(\"focus\", $.proxy(this._onFocus, this));\n      \n      this.element.autocomplete({\n        select: $.proxy(this._onSelect, this),\n        source: $.proxy(this._onSource, this),\n        change: $.proxy(this._onChange, this)\n      });\n    },\n    \n    val: function (item) {\n      if (item === undefined) {\n        return {\n          value: this._getInput().val(),\n          label: this.element.val()\n        };\n      } else {\n        this.element.val(item.label);\n        this._getInput().val(item.value);\n      }\n    },\n    \n    _getInput: function () {\n      var inputName = this.element.attr('data-name');\n      return $('input[name=\"' + inputName + '\"]');\n    },\n    \n    _onFocus: function () {\n      this._originalValue = this._getInput().val();\n      this._originalLabel = this.element.val();\n      this._selected = false;\n    },\n      \n    _onSelect: function (event, ui) {\n      event.preventDefault();\n      var item = ui.item;\n      this.val(item);\n      this._selected = true;\n    },\n\n    _onSource: function (input, callback) {\n      var sourceUrl = this._sourceUrl + (this._sourceUrl.indexOf('?') === -1 ? '?q=' + input.term : '&q=' + input.term);\n      $.get(sourceUrl, function(items) {\n        callback($.map(items, function (item) {\n          return { \n            value: item.value,\n            label: item.label\n          }; \n        }));\n      }, \"json\");\n    },\n    \n    _onChange: function (input, callback) {\n      if (!this._selected) {\n        this.val({\n          value: this._originalValue, \n          label: this._originalLabel\n        });\n      }\n      \n      this._originalValue = null;\n      this._originalLabel = null;\n      this._selected = false;\n    }\n  });\n\t\n  $.widget(\"custom.metaform\", {\n    \n    _create : function() {\n      this.attachedVisibleIfListeners = [];\n      \n      this.element.on(\"submit\", $.proxy(this._onFormSubmit, this));\n      if (!Modernizr.formvalidation) {\n        hyperform(this.element[0]);\n      }\n      \n      this.element.find('*[data-visible-if]').each(function (index, element) {\n        $(element).find('*[required]').each(function (inputIndex, inputElement) {\n          $(inputElement).removeAttr('required');\n          $(inputElement).attr('data-required', 'required');\n        }.bind(this));\n        \n        var formGroupId = $(element).attr('id');\n        var rule = JSON.parse($(element).attr('data-visible-if'));\n        this._registerVisibleIfRule(formGroupId, rule, rule);\n        this.attachedVisibleIfListeners = [];\n      }.bind(this));\n      \n      this.element.find('input:checked').change();\n      this._createDatePickers();\n      this._createTimePickers();\n      this._createDateTimePickers();\n      this._createAutocompleteFields();\n    },\n    \n    val: function (returnArray) {\n      return returnArray ? this.element.serializeArray() : this.element.serialize();\n    },\n    \n    submit: function () {\n      this.element.submit();\n    },\n    \n    addData: function(key, value) {\n      var dataInput = $('<input>')\n        .attr('name', key)\n        .attr('type', 'hidden')\n        .val(value);\n\n      this.element.append(dataInput);\n    },\n    \n    _createDatePickers: function () {\n      this.element.find('input[data-type=\"date\"]').each(function (index, input) {\n        MetaformUtils.createDatePicker(input);\n      });\n    },\n    \n    _createTimePickers: function () {\n      this.element.find('input[data-type=\"time\"]').each(function (index, input) {\n        MetaformUtils.createTimePicker(input);\n      });\n    },\n    \n    _createDateTimePickers: function () {\n      this.element.find('input[data-type=\"date-time\"]').each(function (index, input) {\n        MetaformUtils.createDateTimePicker(input);\n      });\n    },\n    \n    _createAutocompleteFields: function () {\n      this.element.find('input[data-type=\"autocomplete\"]').metaformAutocomplete();\n      this.element.find('input[data-type=\"autocomplete-multiple\"]').metaformMultivalueAutocomplete();\n    },\n    \n    _registerVisibleIfRule: function (formGroupId, currentRule, rule) {\n      if (typeof(currentRule.field) !== 'undefined' && this.attachedVisibleIfListeners.indexOf(currentRule.field) === -1) {\n        this.attachedVisibleIfListeners.push(currentRule.field);\n        \n        $('input[name=\"'+currentRule.field+'\"],select[name=\"'+currentRule.field+'\"]')\n          .change($.proxy(this._createFormChangeFunction(formGroupId, rule), this))\n          .keyup($.proxy(this._createFormChangeFunction(formGroupId, rule), this));\n      }\n      \n      if (typeof(currentRule.and) !== 'undefined') {\n        for (var i = 0; i < currentRule.and.length; i++) {\n          var andSubRule = currentRule.and[i];\n          this._registerVisibleIfRule(formGroupId, andSubRule, rule);\n        }\n      }\n      \n      if (typeof(currentRule.or) !== 'undefined') {\n        for (var j = 0; j < currentRule.or.length; j++) {\n          var orSubRule = currentRule.or[j];\n          this._registerVisibleIfRule(formGroupId, orSubRule, rule);\n        }\n      }\n      \n      $('#' + formGroupId).hide();\n    },\n    _evaluateFormRule: function(rule) {\n      \n      var equals = false;\n      var analyzed = false;\n\n      if (typeof(rule.field) !== 'undefined') {\n        var inputElement = $('input[name=\"'+rule.field+'\"],select[name=\"'+rule.field+'\"]').first();\n        var currentValue = '';\n        var checked = false;\n        \n        if( inputElement.is(':checkbox') || inputElement.is(':radio')) {\n          checked = $('input[name=\"'+rule.field+'\"]:checked').length > 0;\n          currentValue = $('input[name=\"'+rule.field+'\"]:checked').val();\n        } else {\n          checked = inputElement.val() ? true : false;\n          currentValue = inputElement.val();\n        }\n\n        analyzed = true;\n        \n        if (rule.equals === true) {\n          equals = checked;\n        } else if (typeof(rule.equals) !== 'undefined') {\n          equals = rule.equals === currentValue;\n        } else if (rule['not-equals'] === true) {\n          equals = !checked;\n        } else if (typeof(rule['not-equals']) !== 'undefined') {\n          equals = rule['not-equals'] !== currentValue;\n        }\n      }\n\n      if (typeof(rule.and) !== 'undefined') {\n        var andResult = true;\n        for (var i = 0; i < rule.and.length; i++) {\n          var andSubRule = rule.and[i];\n          andResult = andResult && this._evaluateFormRule(andSubRule);\n          if (!andResult) {\n            break;\n          }\n        }\n        equals = analyzed ? equals && andResult : andResult;\n      }\n\n      if (typeof(rule.or) !== 'undefined') {\n        var orResult = false;\n        for (var j = 0; j < rule.or.length; j++) {\n          var orSubRule = rule.or[j];\n          orResult = orResult || this._evaluateFormRule(orSubRule);\n          if (orResult) {\n            break;\n          }\n        }\n        equals = analyzed ? equals || orResult : orResult;\n      }\n      \n      return equals;\n    },\n    _createFormChangeFunction: function(formGroupId, rule) {\n      return function(e) {\n        var formGroup = $('#' + formGroupId);\n        var equals = this._evaluateFormRule(rule);\n        \n        if(equals && !formGroup.is(':visible')) {\n          formGroup.slideToggle(400, function() {\n            this._onRequiredFieldsVisibilityChange(formGroup, 'SHOW');\n          }.bind(this));\n        } else if(!equals && formGroup.is(':visible')){\n          formGroup.slideToggle(400, function() {\n            this._onRequiredFieldsVisibilityChange(formGroup, 'HIDE');\n          }.bind(this));\n        }\n      };\n    },\n\n    _onRequiredFieldsVisibilityChange: function(container, action) {  \n      $(container).find('*[data-required]').each(function (inputIndex, inputElement) {\n        if (action === 'SHOW' && $(inputElement).is(':visible')) {\n          $(inputElement).attr('required', 'required');\n        } else if (action === 'HIDE') {\n          $(inputElement).removeAttr('required');\n        }\n      });\n    },\n\n    _onFormSubmit: function (event) {\n      event.preventDefault();\n      var data = this.val(false);\n\n      $.ajax({\n        url: this.element.attr('data-action') || '/formReply',\n        data: data,\n        method: 'POST',\n        success: (response) => {\n          if ($.isFunction(this.options.onPostSuccess)) {\n            this.options.onPostSuccess(response);\n          } else {\n            bootbox.alert({\n              message: '<i class=\"fa fa-check\" /><h3>Lomake lähetettiin onnistuneesti.</h3>',\n              backdrop: true,\n              callback: function(){\n                window.location.reload(true);\n              }\n            });\n          }\n        },\n        error: (jqXHR, textStatus) => {\n          var errorMessage = textStatus ? jqXHR.responseText || jqXHR.statusText || textStatus : null;\n          if ($.isFunction(this.options.onPostError)) {\n            this.options.onPostError(errorMessage, jqXHR);\n          } else {\n            $('<div>')\n              .addClass('alert alert-danger fixed-top')\n              .text('Lomakkeen lähetys epäonnistui: ' + errorMessage)\n              .appendTo(document.body);\n          }\n        }\n      });\n    }\n  \n  });\n  \n  $.widget(\"custom.tableField\", {\n    \n    _create : function() {\n      this.tableRow = this.element.find('tbody tr:first-child').clone();\n      this.element.on('click', '.add-table-row', $.proxy(this._onAddtableRowClick, this));\n      this.element.on('click', '.print-table', $.proxy(this._onPrintTableClick, this));\n      this.element.on('change', 'input', $.proxy(this._onInputChange, this));\n      this.element.on('change', 'td[data-column-type=\"enum\"] select', $.proxy(this._onEnumSelectChange, this));\n\n      this._refresh();\n\n      if (this.element.find('th[data-calculate-sum=\"true\"]').length) {\n        this.element.find('tfoot').find('td:nth-of-type(1)')\n          .html('Yhteensä:');\n      } else {\n        this.element.find('tfoot').find('td')\n          .html('&nbsp;');\n      }\n      \n      this.element.find('tbody tr').each($.proxy(function (index, row) {\n        this._processTableRow(row);\n      }, this));\n      \n    },\n    \n    removeAllRows: function () {\n      this.element.find('tbody').empty();\n    },\n    \n    addRow: function (data) {\n      this._addRow(data);\n    },\n    \n    _processTableRow: function(row) {\n      $(row).find('[data-column-type=\"enum\"] select').each($.proxy(function (index, select) {\n        this._refreshEnumSelect($(select));\n      }, this));\n      \n      $(row).find('input[data-type=\"table-date\"]').each($.proxy(function (index, input) {\n        MetaformUtils.createDatePicker(input);\n      }, this));\n\n      $(row).find('input[data-type=\"table-time\"]').each($.proxy(function (index, input) {\n        MetaformUtils.createTimePicker(input);\n      }, this));\n    },\n    \n    _addRow: function (data) {\n      var clonedRow = this.tableRow.clone();\n      clonedRow.appendTo(this.element.find('tbody'));\n      clonedRow.find('input,select').each($.proxy(function (index, input) {\n        const columnName = $(input).closest('td').attr('data-column-name');\n        $(input).val(data ? data[columnName] : '');\n      }, this));\n      \n      this._processTableRow(clonedRow);\n      this._refresh();\n    },\n    \n    _refresh: function () {\n      var datas = [];\n      \n      this.element.find('thead th[data-calculate-sum=\"true\"]').each($.proxy(function (rowIndex, row) {\n        var sum = 0;\n        var columnIndex = $(row).index();\n        \n        this.element.find('tbody td:nth-of-type(' + (columnIndex + 1) + ' )').each(function (index, column) {\n          var value = $(column).find('input').val();\n          if (value) {\n            sum += parseFloat(value);\n          }\n        });\n\n        this.element.find('tfoot td:nth-of-type(' + (columnIndex + 1) + ' ) .sum').text(sum);\n      }, this));\n\n      this.element.find('tbody tr').each($.proxy(function (indexRow, row) {\n        var rowDatas = {};\n        \n        $(row).find('td').each($.proxy(function (index, cell) {\n          var value = this._getCellValue(cell);\n          var columnName = $(cell).attr('data-column-name');\n          rowDatas[columnName] = value;\n        }, this));\n        \n        datas.push(rowDatas);\n      }, this));\n      \n      this.element.find('input[name=\"' + this.element.attr('data-field-name') + '\"]').val(JSON.stringify(datas));\n    },\n    \n    _refreshEnumSelect: function (enumSelect) {\n      var other = !!$(enumSelect).find('option:checked').attr('data-other');\n      if (other) {\n        $('<input>')\n          .addClass('enum-other form-control')\n          .css({'width': '50%', 'display': 'inline'})\n          .insertAfter(enumSelect);\n          enumSelect.css({'width': 'calc(50% - 4px)', 'display': 'inline', 'margin-right': '4px'});\n      } else {\n        enumSelect.parent().find('.enum-other').remove();\n        enumSelect.css({'width': '100%', 'display': 'block'});\n      }\n    },\n    \n    _onAddtableRowClick: function (event) {\n      event.preventDefault();\n      this._addRow();\n    },\n    \n    _onInputChange: function (event) {\n      event.preventDefault();\n      this._refresh();\n    },\n    \n    _onEnumSelectChange: function (event) {\n      this._refreshEnumSelect($(event.target));\n      this._refresh();\n    },\n    \n    _getCellValue: function (cell) {\n      var columnType = $(cell).attr('data-column-type');\n      \n      switch (columnType) {\n        case 'enum':\n          var option = $(cell).find('option:checked');\n          if (option.attr('data-other')) {\n            return option.text() + ' ' + $(cell).find('input.enum-other').val();\n          } else {\n            var value = option.attr('value');\n            if (value) {\n              return value;\n            }\n            \n            return option.text();\n          }\n        break;\n        default:\n          return $(cell).find('input').val();\n        break;\n      }\n      \n      return null;\n    },\n    \n    _generatePrintableTable: function () {\n      var tableHeaders = $.map(this.element.find('thead tr th'), function (th) {\n        return {\n          text: $(th).text(),\n          style: 'tableHeader'\n        };\n      });\n      \n      var tableWidths = ['*'];\n      for (var i = 1; i < tableHeaders.length; i++) {\n        tableWidths.push('auto');  \n      }\n      \n      var tableBody = [ tableHeaders ];\n      \n      this.element.find('tbody tr').each($.proxy(function (rowIndex, tr) {\n        var row = [];\n        \n        $(tr).find('td').each($.proxy(function (cellIndex, cell) {\n          var value = this._getCellValue(cell);\n          row.push({\n            text: value||'' \n          });\n        }, this));\n        \n        tableBody.push(row);\n      }, this));\n      \n      this.element.find('tfoot tr').each(function (rowIndex, tr) {\n        var row = [];\n        \n        $(tr).find('td').each(function (cellIndex, cell) {\n          var value = $(cell).text();\n          row.push({\n            text: value||'',\n            style: 'tableFooter'\n          });\n        });\n        \n        tableBody.push(row);\n      });\n      \n      return {\n        content: [{ \n          text: this.element.attr('data-field-title')||'', \n          style: 'header' \n        }, {\n          table: {\n            body: tableBody,\n            widths: tableWidths\n          }\n        }],\n        styles: { \n          header: {\n            fontSize: 18,\n            bold: true,\n            marginBottom: 10\n          },\n          tableHeader: {\n            bold: true\n          },\n          tableFooter: {\n            bold: true\n          }\n        }\n      };\n    },\n    \n    _onPrintTableClick: function (event) {\n      event.preventDefault();\n      \n      var docDefinition = this._generatePrintableTable();\n      \n      pdfMake.createPdf(docDefinition)\n        .download(this.element.attr('data-field-name') + '.pdf');\n    }\n    \n  });\n\t\n  $.widget(\"custom.fileField\", {\n    \n    _create : function() {\n      this._uploadUrl = this.element.attr('data-upload-url') ? this.element.attr('data-upload-url') : '/upload/';\n      this._singleFile = this.element.attr('data-single-file') ? true : false;\n      this._onlyImages = this.element.attr('data-only-images') ? true : false;\n      this._maxFileSize = this.element.attr('data-max-file-size') ? parseInt(this.element.attr('data-max-file-size')) : 209715200;\n      this.element.find('.add-file-button').on(\"click\", $.proxy(this._onAddFileButtonClick, this));\n      this.element.on('click', '.remove-file-button', $.proxy(this._onRemoveFileButtonClick, this));\n      \n      \n      const fileUploadOptions = {\n        maxFileSize: this._maxFileSize,\n        dataType: 'json',\n        url: this._uploadUrl,\n        add : $.proxy(this._onUploadAdd, this),\n        fail: $.proxy(this._onUploadFail, this),\n        done : $.proxy(this._onUploadDone, this),\n        progressall : $.proxy(this._onProgressAll, this) \n      };\n      \n      if (this._onlyImages) {\n        fileUploadOptions.acceptFileTypes = /(\\.|\\/)(gif|jpe?g|png)$/i;\n      }\n      \n      this.element.find('.progress-bar').hide();\n      this.element.find('input[type=\"file\"]')\n        .css({\n          opacity: 0\n        })\n        .fileupload(fileUploadOptions);\n    },\n    \n    _onAddFileButtonClick: function (event) {\n       event.preventDefault();\n       \n       this.element.find('.progress-bar')\n         .show()\n         .removeClass('bg-success')\n         .addClass('progress-bar-animated progress-bar-striped')\n         .css({\n           'width': '0%'  \n         });\n\n       this.element.find('input[type=\"file\"]')[0].click();\n    },\n\n    _onUploadAdd: function (event, data) {\n      this.element.find('.add-file-button')\n        .attr('disabled', 'disabled')\n        .prop('disabled', true)\n        .addClass('disabled');\n      \n      data.submit();\n    },\n    \n    _onUploadFail: function (event, data) {\n      const notification = $('<div>')\n         .addClass('alert alert-danger fixed-top')\n         .text('Kuvan lähetys epäonnistui. Tarkista koko ja tiedostomuoto.')\n         .appendTo(document.body);\n \n      this.element.find('.add-file-button')\n        .removeAttr('disabled')\n        .prop('disabled', false)\n        .removeClass('disabled');\n\n      setTimeout(() => {\n        notification.remove();\n      }, 5000);\n    },\n    \n    _onUploadDone: function (event, data) {\n      if (this._singleFile) {\n        this.element.find('.remove-file-button').click();\n      }\n      \n      this.element.find('.add-file-button')\n        .removeAttr('disabled')\n        .prop('disabled', false)\n        .removeClass('disabled');\n\n      this.element.find('.progress-bar')\n        .removeClass('progress-bar-animated progress-bar-striped')\n        .addClass('bg-success')\n        .css({\n          'width': '100%'  \n        });\n      \n      $.each(data.result, $.proxy(function (index, file) {\n        var row = $('<div>')\n          .addClass('file row')\n          .appendTo(this.element.find('.files'));\n        \n        var cell = $('<div>')\n          .addClass('col-12')\n          .appendTo(row);\n        \n        $('<input>')\n          .attr({\n            'type': 'hidden',\n            'name': this.element.attr('data-field-name'),\n            'value': file.url || file._id\n          })\n          .appendTo(cell);\n        \n        $('<a>')\n          .attr({\n            'href': file.url || this._uploadUrl + file.fileData,\n            'target': 'blank'\n          })\n          .text(file.originalname)\n          .appendTo(cell);\n       \n        $('<button>')\n          .addClass('remove-file-button btn btn-danger btn-sm float-right')\n          .attr('data-id', file._id || file.filename)\n          .attr('data-delete-key', file.deleteKey || '')\n          .text('Poista')\n          .appendTo(cell);\n        \n        $(this.element).trigger('metaform:file-added');\n        \n      }, this));\n    },\n    \n    _onProgressAll: function (event, data) {\n      var progress = parseInt(data.loaded / data.total * 100, 10);\n      this.element.find('.progress-bar')\n        .css({\n          'width': progress + '%'  \n        });\n    },\n    \n    _onRemoveFileButtonClick: function (event) {\n      event.preventDefault();\n      var button = $(event.target).closest('.remove-file-button');\n      var fileId = button.attr('data-id');\n      var deleteKey = button.attr('data-delete-key');\n      \n      let url = this._uploadUrl + fileId;\n      if (deleteKey && deleteKey.length > 0) {\n        url += '?c=' + deleteKey;\n      }\n      \n      $.ajax({\n        url: url,\n        method: 'DELETE',\n        success: $.proxy(function(res) {\n          $(button).closest('.file').remove();\n          $(this.element).trigger('metaform:file-removed');\n        }, this)\n      });\n    }\n  });\n  \n  $(document).ready(function () {\n    if ((typeof Modernizr) === 'undefined') {\n      alert('Modernizr is not loaded');\n    }\n    \n    $('form.metaform').metaform();\n    $('.file-component').fileField();\n    $('.table-field').tableField();\n  });\n  \n})(jQuery);"]}