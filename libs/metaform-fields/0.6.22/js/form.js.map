{"version":3,"sources":["../../../src/js/form.js"],"names":["$","widget","options","customSource","_create","_sourceUrl","element","attr","_required","autocomplete","select","proxy","_onSelect","source","_onSource","change","_onChange","_valuesContainer","addClass","insertAfter","on","_onValueRemoveClick","_loadValues","val","values","find","remove","_addValues","valuesAttr","JSON","parse","i","length","_addItem","value","label","_updateValues","append","appendTo","map","index","get","inputName","closest","join","empty","setCustomValidity","event","preventDefault","target","ui","item","input","callback","sourceUrl","indexOf","term","items","_selected","_onFocus","valueInput","_getInput","undefined","_originalValue","_originalLabel","animation","framework","window","draftUrl","document","_saveDraft","_sendDraftToEmail","fileField","tableField","attachedVisibleIfListeners","_onFormSubmit","Modernizr","formvalidation","hyperform","each","inputIndex","inputElement","removeAttr","bind","formGroupId","rule","_registerVisibleIfRule","_createDatePickers","_createTimePickers","_createDateTimePickers","_createAutocompleteFields","_createReadonlyDateTimes","returnArray","serializeArray","serialize","submit","addData","key","dataInput","MetaformUtils","createDatePicker","createTimePicker","createDateTimePicker","moment","language","navigator","userLanguage","locale","text","format","metaformAutocomplete","metaformMultivalueAutocomplete","currentRule","field","push","_createFormChangeFunction","keyup","and","andSubRule","or","j","orSubRule","_evaluateFormRule","hide","equals","analyzed","first","currentValue","checked","is","andResult","orResult","e","formGroup","trigger","_show","_onRequiredFieldsVisibilityChange","_hide","show","duration","effect","slideDown","slideUp","container","action","data","url","location","href","urlParams","search","ajax","reply","method","success","response","responseJson","replyId","urlObject","URL","searchParams","delete","drafReplytUrl","error","email","prompt","_sendEmail","emailData","alert","isFunction","beforeFormSubmit","onPostSuccess","bootbox","message","backdrop","reload","jqXHR","textStatus","errorMessage","responseText","statusText","onPostError","body","tableRow","clone","_onAddTableRowClick","_onPrintTableClick","_onInputChange","_onEnumSelectChange","_onDeleteRowClick","html","sortable","handle","stop","_refresh","row","_processTableRow","removeAllRows","addRow","_addRow","setCellValue","columnName","rowIndex","cell","_setCellValue","rowDatas","forEach","rowData","_refreshEnumSelect","afterProcessRow","clonedRow","datas","sum","columnIndex","column","parseFloat","indexRow","_getCellValue","stringify","enumSelect","other","css","parent","columnType","option","_generatePrintableTable","tableHeaders","th","style","tableWidths","tableBody","tr","cellIndex","content","table","widths","styles","header","fontSize","bold","marginBottom","tableHeader","tableFooter","docDefinition","pdfMake","createPdf","download","_uploadUrl","_singleFile","_onlyImages","_maxFileSize","parseInt","_onAddFileButtonClick","_onRemoveFileButtonClick","fileUploadOptions","maxFileSize","dataType","add","_onUploadAdd","fail","_onUploadFail","done","_onUploadDone","progressall","_onProgressAll","acceptFileTypes","opacity","fileupload","removeClass","click","prop","notification","setTimeout","result","file","fileId","_id","fileData","filename","fileUrl","deleteUrl","deleteKey","originalName","originalname","fieldName","progress","loaded","total","button","res","ready","metaform","jQuery"],"mappings":"aAAA,wBACA,kEACA,CAAC,SAASA,CAAT,CAAY,CACX,aAEAA,EAAEC,MAAF,CAAS,uCAAT,CAAkD,CAChDC,QAAS,CACPC,aAAc,IADP,CADuC,CAKhDC,QAAU,kBAAW,CACnB,KAAKC,UAAL,CAAkB,KAAKC,OAAL,CAAaC,IAAb,CAAkB,iBAAlB,CAAlB,CACA,KAAKC,SAAL,CAAiB,CAAC,CAAC,KAAKF,OAAL,CAAaC,IAAb,CAAkB,eAAlB,CAAnB,CAEA,KAAKD,OAAL,CAAaG,YAAb,CAA0B,CACxBC,OAAQV,EAAEW,KAAF,CAAQ,KAAKC,SAAb,CAAwB,IAAxB,CADgB,CAExBC,OAAQb,EAAEW,KAAF,CAAQ,KAAKG,SAAb,CAAwB,IAAxB,CAFgB,CAGxBC,OAAQf,EAAEW,KAAF,CAAQ,KAAKK,SAAb,CAAwB,IAAxB,CAHgB,CAA1B,EAMA,KAAKC,gBAAL,CAAwBjB,EAAE,OAAF,EACrBkB,QADqB,CACZ,4BADY,EAErBC,WAFqB,CAET,KAAKb,OAFI,CAAxB,CAIA,KAAKW,gBAAL,CAAsBG,EAAtB,CAAyB,OAAzB,CAAkC,0CAAlC,CAA8EpB,EAAEW,KAAF,CAAQ,KAAKU,mBAAb,CAAkC,IAAlC,CAA9E,EAEA,KAAKC,WAAL,EACD,CAtB+C,CAwBhDC,IAAK,aAAUC,MAAV,CAAkB,CACrB,KAAKP,gBAAL,CAAsBQ,IAAtB,CAA2B,wCAA3B,EAAqEC,MAArE,GACA,KAAKC,UAAL,CAAgBH,MAAhB,CACD,CA3B+C,CA6BhDF,YAAa,sBAAY,CACvB,GAAMM,YAAa,KAAKtB,OAAL,CAAaC,IAAb,CAAkB,aAAlB,CAAnB,CAEA,GAAIqB,UAAJ,CAAgB,CACd,KAAKD,UAAL,CAAgBE,KAAKC,KAAL,CAAWF,UAAX,CAAhB,CACD,CACF,CAnC+C,CAqChDD,WAAY,oBAAUH,MAAV,CAAkB,CAC5B,GAAIA,MAAJ,CAAY,CACV,IAAK,GAAIO,GAAI,CAAb,CAAgBA,EAAIP,OAAOQ,MAA3B,CAAmCD,GAAnC,CAAwC,CACtC,KAAKE,QAAL,CAAcT,OAAOO,CAAP,EAAUG,KAAxB,CAA+BV,OAAOO,CAAP,EAAUI,KAAzC,CACD,CAED,KAAKC,aAAL,EACD,CACF,CA7C+C,CA+ChDH,SAAU,kBAAUC,KAAV,CAAiBC,KAAjB,CAAwB,CAChCnC,EAAE,QAAF,EACGkB,QADH,CACY,uCADZ,EAEGX,IAFH,CAEQ,YAFR,CAEsB2B,KAFtB,EAGG3B,IAHH,CAGQ,YAHR,CAGsB4B,KAHtB,EAIGE,MAJH,CAIUrC,EAAE,KAAF,EAASO,IAAT,CAAc,MAAd,CAAsB,GAAtB,EAA2BW,QAA3B,CAAoC,qDAApC,CAJV,EAKGmB,MALH,CAKU,QALV,EAMGA,MANH,CAMUF,KANV,EAOGG,QAPH,CAOY,KAAKrB,gBAPjB,CAQD,CAxD+C,CA0DhDmB,cAAe,wBAAY,CACzB,GAAMZ,QAAS,KAAKP,gBAAL,CAAsBQ,IAAtB,CAA2B,wCAA3B,EAAqEc,GAArE,CAAyE,SAAUC,KAAV,CAAiBlC,OAAjB,CAA0B,CAChH,MAAON,GAAEM,OAAF,EAAWC,IAAX,CAAgB,YAAhB,CACR,CAFc,EAEZkC,GAFY,EAAf,CAIA,GAAIC,WAAY,KAAKpC,OAAL,CAAaC,IAAb,CAAkB,WAAlB,CAAhB,CACA,KAAKD,OAAL,CAAaqC,OAAb,CAAqB,WAArB,EAAkClB,IAAlC,CAAuC,eAAiBiB,SAAjB,CAA6B,IAApE,EAA0EnB,GAA1E,CAA8EC,OAAOoB,IAAP,CAAY,GAAZ,CAA9E,EAEA,GAAI,KAAKpC,SAAT,CAAoB,CAClB,GAAIqC,OAAQ,CAAC,KAAKvC,OAAL,CAAaqC,OAAb,CAAqB,WAArB,EAAkClB,IAAlC,CAAuC,eAAiBiB,SAAjB,CAA6B,IAApE,EAA0EnB,GAA1E,EAAb,CACA,KAAKjB,OAAL,CAAa,CAAb,EAAgBwC,iBAAhB,CAAkCD,MAAQ,0BAAR,CAAqC,EAAvE,CACD,CACF,CAtE+C,CAwEhDxB,oBAAqB,6BAAU0B,KAAV,CAAiB,CACpCA,MAAMC,cAAN,GACAhD,EAAE+C,MAAME,MAAR,EACGN,OADH,CACW,wCADX,EAEGjB,MAFH,GAIA,KAAKU,aAAL,EACD,CA/E+C,CAiFhDxB,UAAW,mBAAUmC,KAAV,CAAiBG,EAAjB,CAAqB,CAC9BH,MAAMC,cAAN,GACA,GAAIG,MAAOD,GAAGC,IAAd,CACA,KAAK7C,OAAL,CAAaiB,GAAb,CAAiB,EAAjB,EACA,KAAKU,QAAL,CAAckB,KAAKjB,KAAnB,CAA0BiB,KAAKhB,KAA/B,EACA,KAAKC,aAAL,EACD,CAvF+C,CAyFhDtB,UAAW,mBAAUsC,KAAV,CAAiBC,QAAjB,CAA2B,CACpC,GAAI,KAAKnD,OAAL,CAAaC,YAAjB,CAA+B,CAC7B,KAAKD,OAAL,CAAaC,YAAb,CAA0BiD,KAA1B,CAAiCC,QAAjC,CACD,CAFD,IAEO,CACL,GAAIC,WAAY,KAAKjD,UAAL,EAAmB,KAAKA,UAAL,CAAgBkD,OAAhB,CAAwB,GAAxB,IAAiC,CAAC,CAAlC,CAAsC,MAAQH,MAAMI,IAApD,CAA2D,MAAQJ,MAAMI,IAA5F,CAAhB,CACAxD,EAAEyC,GAAF,CAAMa,SAAN,CAAiB,SAASG,KAAT,CAAgB,CAC/BJ,SAASrD,EAAEuC,GAAF,CAAMkB,KAAN,CAAa,SAAUN,IAAV,CAAgB,CACpC,MAAO,CACLjB,MAAOiB,KAAKjB,KADP,CAELC,MAAOgB,KAAKhB,KAFP,CAIR,CALQ,CAAT,CAMD,CAPD,CAOG,MAPH,CAQD,CACF,CAvG+C,CAyGhDnB,UAAW,mBAAUoC,KAAV,CAAiBC,QAAjB,CAA2B,CACpC,KAAK/C,OAAL,CAAaiB,GAAb,CAAiB,EAAjB,CACD,CA3G+C,CAAlD,EA8GAvB,EAAEC,MAAF,CAAS,6BAAT,CAAwC,CACtCC,QAAS,CACPC,aAAc,IADP,CAD6B,CAKtCC,QAAU,kBAAW,CACnB,KAAKC,UAAL,CAAkB,KAAKC,OAAL,CAAaC,IAAb,CAAkB,iBAAlB,CAAlB,CACA,KAAKmD,SAAL,CAAiB,KAAjB,CAEA,KAAKpD,OAAL,CAAac,EAAb,CAAgB,OAAhB,CAAyBpB,EAAEW,KAAF,CAAQ,KAAKgD,QAAb,CAAuB,IAAvB,CAAzB,EAEA,KAAKrD,OAAL,CAAaG,YAAb,CAA0B,CACxBC,OAAQV,EAAEW,KAAF,CAAQ,KAAKC,SAAb,CAAwB,IAAxB,CADgB,CAExBC,OAAQb,EAAEW,KAAF,CAAQ,KAAKG,SAAb,CAAwB,IAAxB,CAFgB,CAGxBC,OAAQf,EAAEW,KAAF,CAAQ,KAAKK,SAAb,CAAwB,IAAxB,CAHgB,CAA1B,CAKD,CAhBqC,CAkBtCO,IAAK,aAAU4B,IAAV,CAAgB,CACnB,GAAMS,YAAa,KAAKC,SAAL,EAAnB,CAEA,GAAIV,OAASW,SAAb,CAAwB,CACtB,GAAI5B,OAAQ,IAAZ,CACA,GAAI0B,WAAW5B,MAAX,CAAoB,CAAxB,CAA2B,CACzBE,MAAQ0B,WAAWrC,GAAX,EACT,CAFD,IAEO,CACLW,MAAQ,KAAK5B,OAAL,CAAaC,IAAb,CAAkB,YAAlB,CACT,CACD,MAAO,CACL2B,MAAOA,KADF,CAELC,MAAO,KAAK7B,OAAL,CAAaiB,GAAb,EAFF,CAIR,CAXD,IAWO,CACL,KAAKjB,OAAL,CAAaiB,GAAb,CAAiB4B,KAAKhB,KAAtB,EACA,GAAIyB,WAAW5B,MAAX,CAAoB,CAAxB,CAA2B,CACzB4B,WAAWrC,GAAX,CAAe4B,KAAKjB,KAApB,CACD,CAFD,IAEO,CACL,KAAK5B,OAAL,CAAaC,IAAb,CAAkB,YAAlB,CAAgC4C,KAAKjB,KAArC,CACD,CACF,CACF,CAxCqC,CA0CtC2B,UAAW,oBAAY,CACrB,GAAInB,WAAY,KAAKpC,OAAL,CAAaC,IAAb,CAAkB,WAAlB,CAAhB,CACA,MAAO,MAAKD,OAAL,CAAaqC,OAAb,CAAqB,WAArB,EAAkClB,IAAlC,CAAuC,eAAiBiB,SAAjB,CAA6B,IAApE,CACR,CA7CqC,CA+CtCiB,SAAU,mBAAY,CACpB,KAAKI,cAAL,CAAsB,KAAKF,SAAL,GAAiBtC,GAAjB,EAAtB,CACA,KAAKyC,cAAL,CAAsB,KAAK1D,OAAL,CAAaiB,GAAb,EAAtB,CACA,KAAKmC,SAAL,CAAiB,KAClB,CAnDqC,CAqDtC9C,UAAW,mBAAUmC,KAAV,CAAiBG,EAAjB,CAAqB,CAC9BH,MAAMC,cAAN,GACA,GAAIG,MAAOD,GAAGC,IAAd,CACA,KAAK5B,GAAL,CAAS4B,IAAT,EACA,KAAKO,SAAL,CAAiB,IAClB,CA1DqC,CA4DtC5C,UAAW,mBAAUsC,KAAV,CAAiBC,QAAjB,CAA2B,CACpC,GAAI,KAAKnD,OAAL,CAAaC,YAAjB,CAA+B,CAC7B,KAAKD,OAAL,CAAaC,YAAb,CAA0BiD,KAA1B,CAAiCC,QAAjC,CACD,CAFD,IAEO,CACL,GAAIC,WAAY,KAAKjD,UAAL,EAAmB,KAAKA,UAAL,CAAgBkD,OAAhB,CAAwB,GAAxB,IAAiC,CAAC,CAAlC,CAAsC,MAAQH,MAAMI,IAApD,CAA2D,MAAQJ,MAAMI,IAA5F,CAAhB,CACAxD,EAAEyC,GAAF,CAAMa,SAAN,CAAiB,SAASG,KAAT,CAAgB,CAC/BJ,SAASrD,EAAEuC,GAAF,CAAMkB,KAAN,CAAa,SAAUN,IAAV,CAAgB,CACpC,MAAO,CACLjB,MAAOiB,KAAKjB,KADP,CAELC,MAAOgB,KAAKhB,KAFP,CAIR,CALQ,CAAT,CAMD,CAPD,CAOG,MAPH,CAQD,CACF,CA1EqC,CA4EtCnB,UAAW,mBAAUoC,KAAV,CAAiBC,QAAjB,CAA2B,CACpC,GAAI,CAAC,KAAKK,SAAV,CAAqB,CACnB,KAAKnC,GAAL,CAAS,CACPW,MAAO,KAAK6B,cADL,CAEP5B,MAAO,KAAK6B,cAFL,CAAT,CAID,CAED,KAAKD,cAAL,CAAsB,IAAtB,CACA,KAAKC,cAAL,CAAsB,IAAtB,CACA,KAAKN,SAAL,CAAiB,KAClB,CAvFqC,CAAxC,EA0FA1D,EAAEC,MAAF,CAAS,iBAAT,CAA4B,CAE1BC,QAAS,CACP+D,UAAW,CACTC,UAAW,SADF,CADJ,CAFiB,CAQ1B9D,QAAU,kBAAW,CACnB+D,OAAOC,QAAP,CAAkB,YAAlB,CACApE,EAAEqE,QAAF,EAAYjD,EAAZ,CAAe,OAAf,CAAwB,sBAAxB,CAAgDpB,EAAEW,KAAF,CAAQ,KAAK2D,UAAb,CAAyB,IAAzB,CAAhD,EACAtE,EAAEqE,QAAF,EAAYjD,EAAZ,CAAe,OAAf,CAAwB,mBAAxB,CAA6CpB,EAAEW,KAAF,CAAQ,KAAK4D,iBAAb,CAAgC,IAAhC,CAA7C,EAEA,KAAKjE,OAAL,CAAamB,IAAb,CAAkB,iBAAlB,EAAqC+C,SAArC,GACA,KAAKlE,OAAL,CAAamB,IAAb,CAAkB,cAAlB,EAAkCgD,UAAlC,GAEA,KAAKC,0BAAL,CAAkC,EAAlC,CAEA,KAAKpE,OAAL,CAAac,EAAb,CAAgB,QAAhB,CAA0BpB,EAAEW,KAAF,CAAQ,KAAKgE,aAAb,CAA4B,IAA5B,CAA1B,EACA,GAAI,CAACC,UAAUC,cAAf,CAA+B,CAC7BC,UAAU,KAAKxE,OAAL,CAAa,CAAb,CAAV,CACD,CAED,KAAKA,OAAL,CAAamB,IAAb,CAAkB,oBAAlB,EAAwCsD,IAAxC,CAA6C,SAAUvC,KAAV,CAAiBlC,OAAjB,CAA0B,CACrEN,EAAEM,OAAF,EAAWmB,IAAX,CAAgB,aAAhB,EAA+BsD,IAA/B,CAAoC,SAAUC,UAAV,CAAsBC,YAAtB,CAAoC,CACtEjF,EAAEiF,YAAF,EAAgBC,UAAhB,CAA2B,UAA3B,EACAlF,EAAEiF,YAAF,EAAgB1E,IAAhB,CAAqB,eAArB,CAAsC,UAAtC,CACD,CAHmC,CAGlC4E,IAHkC,CAG7B,IAH6B,CAApC,EAKA,GAAIC,aAAcpF,EAAEM,OAAF,EAAWC,IAAX,CAAgB,IAAhB,CAAlB,CACA,GAAI8E,MAAOxD,KAAKC,KAAL,CAAW9B,EAAEM,OAAF,EAAWC,IAAX,CAAgB,iBAAhB,CAAX,CAAX,CACA,KAAK+E,sBAAL,CAA4BF,WAA5B,CAAyCC,IAAzC,CAA+CA,IAA/C,EACA,KAAKX,0BAAL,CAAkC,EACnC,CAV4C,CAU3CS,IAV2C,CAUtC,IAVsC,CAA7C,EAYA,KAAK7E,OAAL,CAAamB,IAAb,CAAkB,eAAlB,EAAmCV,MAAnC,GACA,KAAKwE,kBAAL,GACA,KAAKC,kBAAL,GACA,KAAKC,sBAAL,GACA,KAAKC,yBAAL,GACA,KAAKC,wBAAL,EACD,CAzCyB,CA2C1BpE,IAAK,aAAUqE,WAAV,CAAuB,CAC1B,MAAOA,aAAc,KAAKtF,OAAL,CAAauF,cAAb,EAAd,CAA8C,KAAKvF,OAAL,CAAawF,SAAb,EACtD,CA7CyB,CA+C1BC,OAAQ,iBAAY,CAClB,KAAKzF,OAAL,CAAayF,MAAb,EACD,CAjDyB,CAmD1BC,QAAS,iBAASC,GAAT,CAAc/D,KAAd,CAAqB,CAC5B,GAAIgE,WAAYlG,EAAE,SAAF,EACbO,IADa,CACR,MADQ,CACA0F,GADA,EAEb1F,IAFa,CAER,MAFQ,CAEA,QAFA,EAGbgB,GAHa,CAGTW,KAHS,CAAhB,CAKA,KAAK5B,OAAL,CAAa+B,MAAb,CAAoB6D,SAApB,CACD,CA1DyB,CA4D1BX,mBAAoB,6BAAY,CAC9B,KAAKjF,OAAL,CAAamB,IAAb,CAAkB,yBAAlB,EAA6CsD,IAA7C,CAAkD,SAAUvC,KAAV,CAAiBY,KAAjB,CAAwB,CACxE+C,cAAcC,gBAAd,CAA+BhD,KAA/B,CACD,CAFD,CAGD,CAhEyB,CAkE1BoC,mBAAoB,6BAAY,CAC9B,KAAKlF,OAAL,CAAamB,IAAb,CAAkB,yBAAlB,EAA6CsD,IAA7C,CAAkD,SAAUvC,KAAV,CAAiBY,KAAjB,CAAwB,CACxE+C,cAAcE,gBAAd,CAA+BjD,KAA/B,CACD,CAFD,CAGD,CAtEyB,CAwE1BqC,uBAAwB,iCAAY,CAClC,KAAKnF,OAAL,CAAamB,IAAb,CAAkB,8BAAlB,EAAkDsD,IAAlD,CAAuD,SAAUvC,KAAV,CAAiBY,KAAjB,CAAwB,CAC7E+C,cAAcG,oBAAd,CAAmClD,KAAnC,CACD,CAFD,CAGD,CA5EyB,CA8E1BuC,yBAA0B,mCAAY,CACpC,GAAI,MAAOY,OAAP,GAAkB,UAAtB,CAAkC,CAChC,MACD,CAED,GAAMC,UAAWrC,OAAOsC,SAAP,CAAiBC,YAAjB,EAAiCvC,OAAOsC,SAAP,CAAiBD,QAAnE,CACA,GAAIA,QAAJ,CAAc,CACZD,OAAOI,MAAP,CAAcH,QAAd,CACD,CAED,KAAKlG,OAAL,CAAamB,IAAb,CAAkB,qBAAlB,EAAyCsD,IAAzC,CAA8C,SAAUvC,KAAV,CAAiBlC,OAAjB,CAA0B,CACtE,GAAM4B,OAAQlC,EAAEM,OAAF,EAAWsG,IAAX,EAAd,CACA,GAAMC,QAAS7G,EAAEM,OAAF,EAAWC,IAAX,CAAgB,aAAhB,CAAf,CACA,GAAI2B,KAAJ,CAAW,CACTlC,EAAEM,OAAF,EAAWsG,IAAX,CAAgBL,OAAOrE,KAAP,EAAc2E,MAAd,CAAqBA,QAAU,KAA/B,CAAhB,CACD,CACF,CAND,CAOD,CA/FyB,CAiG1BnB,0BAA2B,oCAAY,CACrC,KAAKpF,OAAL,CAAamB,IAAb,CAAkB,iCAAlB,EAAqDqF,oBAArD,GACA,KAAKxG,OAAL,CAAamB,IAAb,CAAkB,0CAAlB,EAA8DsF,8BAA9D,EACD,CApGyB,CAsG1BzB,uBAAwB,gCAAUF,WAAV,CAAuB4B,WAAvB,CAAoC3B,IAApC,CAA0C,CAChE,GAAI,MAAO2B,aAAYC,KAAnB,GAA8B,WAA9B,EAA6C,KAAKvC,0BAAL,CAAgCnB,OAAhC,CAAwCyD,YAAYC,KAApD,IAA+D,CAAC,CAAjH,CAAoH,CAClH,KAAKvC,0BAAL,CAAgCwC,IAAhC,CAAqCF,YAAYC,KAAjD,EAEA,KAAK3G,OAAL,CAAamB,IAAb,CAAkB,eAAeuF,YAAYC,KAA3B,CAAiC,kBAAjC,CAAoDD,YAAYC,KAAhE,CAAsE,IAAxF,EACGlG,MADH,CACUf,EAAEW,KAAF,CAAQ,KAAKwG,yBAAL,CAA+B/B,WAA/B,CAA4CC,IAA5C,CAAR,CAA2D,IAA3D,CADV,EAEG+B,KAFH,CAESpH,EAAEW,KAAF,CAAQ,KAAKwG,yBAAL,CAA+B/B,WAA/B,CAA4CC,IAA5C,CAAR,CAA2D,IAA3D,CAFT,CAGD,CAED,GAAI,MAAO2B,aAAYK,GAAnB,GAA4B,WAAhC,CAA6C,CAC3C,IAAK,GAAItF,GAAI,CAAb,CAAgBA,EAAIiF,YAAYK,GAAZ,CAAgBrF,MAApC,CAA4CD,GAA5C,CAAiD,CAC/C,GAAIuF,YAAaN,YAAYK,GAAZ,CAAgBtF,CAAhB,CAAjB,CACA,KAAKuD,sBAAL,CAA4BF,WAA5B,CAAyCkC,UAAzC,CAAqDjC,IAArD,CACD,CACF,CAED,GAAI,MAAO2B,aAAYO,EAAnB,GAA2B,WAA/B,CAA4C,CAC1C,IAAK,GAAIC,GAAI,CAAb,CAAgBA,EAAIR,YAAYO,EAAZ,CAAevF,MAAnC,CAA2CwF,GAA3C,CAAgD,CAC9C,GAAIC,WAAYT,YAAYO,EAAZ,CAAeC,CAAf,CAAhB,CACA,KAAKlC,sBAAL,CAA4BF,WAA5B,CAAyCqC,SAAzC,CAAoDpC,IAApD,CACD,CACF,CAED,GAAI,CAAC,KAAKqC,iBAAL,CAAuBrC,IAAvB,CAAL,CAAmC,CACjC,KAAK/E,OAAL,CAAamB,IAAb,KAAsB2D,WAAtB,EAAqCuC,IAArC,EACD,CACF,CAhIyB,CAkI1BD,kBAAmB,2BAASrC,IAAT,CAAe,CAChC,GAAIuC,QAAS,KAAb,CACA,GAAIC,UAAW,KAAf,CAEA,GAAI,MAAOxC,MAAK4B,KAAZ,GAAuB,WAA3B,CAAwC,CACtC,GAAIhC,cAAe,KAAK3E,OAAL,CAAamB,IAAb,CAAkB,eAAe4D,KAAK4B,KAApB,CAA0B,kBAA1B,CAA6C5B,KAAK4B,KAAlD,CAAwD,IAA1E,EAAgFa,KAAhF,EAAnB,CACA,GAAIC,cAAe,EAAnB,CACA,GAAIC,SAAU,KAAd,CAEA,GAAI/C,aAAagD,EAAb,CAAgB,WAAhB,GAAgChD,aAAagD,EAAb,CAAgB,QAAhB,CAApC,CAA+D,CAC7DD,QAAU,KAAK1H,OAAL,CAAamB,IAAb,CAAkB,eAAe4D,KAAK4B,KAApB,CAA0B,YAA5C,EAA0DjF,MAA1D,CAAmE,CAA7E,CACA+F,aAAe,KAAKzH,OAAL,CAAamB,IAAb,CAAkB,eAAe4D,KAAK4B,KAApB,CAA0B,YAA5C,EAA0D1F,GAA1D,EAChB,CAHD,IAGO,CACLyG,QAAU/C,aAAa1D,GAAb,GAAqB,IAArB,CAA4B,KAAtC,CACAwG,aAAe9C,aAAa1D,GAAb,EAChB,CAEDsG,SAAW,IAAX,CAEA,GAAIxC,KAAKuC,MAAL,GAAgB,IAApB,CAA0B,CACxBA,OAASI,OACV,CAFD,IAEO,IAAI,MAAO3C,MAAKuC,MAAZ,GAAwB,WAA5B,CAAyC,CAC9CA,OAASvC,KAAKuC,MAAL,GAAgBG,YAC1B,CAFM,IAEA,IAAI1C,KAAK,YAAL,IAAuB,IAA3B,CAAiC,CACtCuC,OAAS,CAACI,OACX,CAFM,IAEA,IAAI,MAAO3C,MAAK,YAAL,CAAP,GAA+B,WAAnC,CAAgD,CACrDuC,OAASvC,KAAK,YAAL,IAAuB0C,YACjC,CACF,CAED,GAAI,MAAO1C,MAAKgC,GAAZ,GAAqB,WAAzB,CAAsC,CACpC,GAAIa,WAAY,IAAhB,CACA,IAAK,GAAInG,GAAI,CAAb,CAAgBA,EAAIsD,KAAKgC,GAAL,CAASrF,MAA7B,CAAqCD,GAArC,CAA0C,CACxC,GAAIuF,YAAajC,KAAKgC,GAAL,CAAStF,CAAT,CAAjB,CACAmG,UAAYA,WAAa,KAAKR,iBAAL,CAAuBJ,UAAvB,CAAzB,CACA,GAAI,CAACY,SAAL,CAAgB,CACd,KACD,CACF,CACDN,OAASC,SAAWD,QAAUM,SAArB,CAAiCA,SAC3C,CAED,GAAI,MAAO7C,MAAKkC,EAAZ,GAAoB,WAAxB,CAAqC,CACnC,GAAIY,UAAW,KAAf,CACA,IAAK,GAAIX,GAAI,CAAb,CAAgBA,EAAInC,KAAKkC,EAAL,CAAQvF,MAA5B,CAAoCwF,GAApC,CAAyC,CACvC,GAAIC,WAAYpC,KAAKkC,EAAL,CAAQC,CAAR,CAAhB,CACAW,SAAWA,UAAY,KAAKT,iBAAL,CAAuBD,SAAvB,CAAvB,CACA,GAAIU,QAAJ,CAAc,CACZ,KACD,CACF,CACDP,OAASC,SAAWD,QAAUO,QAArB,CAAgCA,QAC1C,CAED,MAAOP,OACR,CAzLyB,CA2L1BT,0BAA2B,mCAAS/B,WAAT,CAAsBC,IAAtB,CAA4B,CACrD,MAAO,UAAS+C,CAAT,CAAY,gBACjB,GAAMC,WAAY,KAAK/H,OAAL,CAAamB,IAAb,KAAsB2D,WAAtB,CAAlB,CACA,GAAMwC,QAAS,KAAKF,iBAAL,CAAuBrC,IAAvB,CAAf,CAEA,GAAIuC,MAAJ,CAAY,CACV,KAAKtH,OAAL,CAAagI,OAAb,CAAqB,YAArB,CAAmC,CACjCrF,OAAQoF,SADyB,CAAnC,EAIA,KAAKE,KAAL,CAAWF,SAAX,CAAsB,UAAM,CAC1B,MAAKG,iCAAL,CAAuCH,SAAvC,CAAkD,MAAlD,EACA,MAAK/H,OAAL,CAAagI,OAAb,CAAqB,WAArB,CAAkC,CAChCrF,OAAQoF,SADwB,CAAlC,CAGD,CALD,CAMD,CAXD,IAWO,IAAG,CAACT,MAAJ,CAAY,CACjB,KAAKtH,OAAL,CAAagI,OAAb,CAAqB,YAArB,CAAmC,CACjCrF,OAAQoF,SADyB,CAAnC,EAIA,KAAKI,KAAL,CAAWJ,SAAX,CAAsB,UAAM,CAC1B,MAAKG,iCAAL,CAAuCH,SAAvC,CAAkD,MAAlD,EACA,MAAK/H,OAAL,CAAagI,OAAb,CAAqB,WAArB,CAAkC,CAChCrF,OAAQoF,SADwB,CAAlC,CAGD,CALD,CAMD,CACF,CACF,CAxNyB,CA0N1BE,MAAO,eAAUjI,OAAV,CAAmB+C,QAAnB,CAA6B,CAClC,GAAMqF,MAAO,KAAKxI,OAAL,CAAa+D,SAAb,CAAuByE,IAAvB,EAA+B,EAA5C,CACA,GAAMC,UAAWD,KAAKC,QAAL,EAAiB,GAAlC,CACA,GAAMzI,SAAUwI,KAAKxI,OAAL,EAAgB,EAAhC,CACA,GAAM0I,QAASF,KAAKE,MAAL,EAAe,OAA9B,CAEA,OAAQ,KAAK1I,OAAL,CAAa+D,SAAb,CAAuBC,SAA/B,EACE,IAAK,WAAL,CACE5D,QAAQoI,IAAR,CAAaE,MAAb,CAAqB1I,OAArB,CAA8ByI,QAA9B,CAAwCtF,QAAxC,EACF,MACA,QACE/C,QAAQuI,SAAR,CAAkBF,QAAlB,CAA4BtF,QAA5B,EACF,MANF,CAQD,CAxOyB,CA0O1BoF,MAAO,eAAUnI,OAAV,CAAmB+C,QAAnB,CAA6B,CAClC,GAAMsE,MAAO,KAAKzH,OAAL,CAAa+D,SAAb,CAAuB0D,IAAvB,EAA+B,EAA5C,CACA,GAAMgB,UAAWhB,KAAKgB,QAAL,EAAiB,GAAlC,CACA,GAAMzI,SAAUyH,KAAKzH,OAAL,EAAgB,EAAhC,CACA,GAAM0I,QAASjB,KAAKiB,MAAL,EAAe,OAA9B,CAEA,OAAQ,KAAK1I,OAAL,CAAa+D,SAAb,CAAuBC,SAA/B,EACE,IAAK,WAAL,CACE5D,QAAQqH,IAAR,CAAaiB,MAAb,CAAqB1I,OAArB,CAA8ByI,QAA9B,CAAwCtF,QAAxC,EACF,MACA,QACE/C,QAAQwI,OAAR,CAAgBH,QAAhB,CAA0BtF,QAA1B,EACF,MANF,CAQD,CAxPyB,CA0P1BmF,kCAAmC,2CAASO,SAAT,CAAoBC,MAApB,CAA4B,CAC7DhJ,EAAE+I,SAAF,EAAatH,IAAb,CAAkB,kBAAlB,EAAsCsD,IAAtC,CAA2C,SAAUC,UAAV,CAAsBC,YAAtB,CAAoC,CAC7E,GAAI+D,SAAW,MAAX,EAAqBhJ,EAAEiF,YAAF,EAAgBgD,EAAhB,CAAmB,UAAnB,CAAzB,CAAyD,CACvDjI,EAAEiF,YAAF,EAAgB1E,IAAhB,CAAqB,UAArB,CAAiC,UAAjC,CACD,CAFD,IAEO,IAAIyI,SAAW,MAAf,CAAuB,CAC5BhJ,EAAEiF,YAAF,EAAgBC,UAAhB,CAA2B,UAA3B,CACD,CACF,CAND,CAOD,CAlQyB,CAoQ1BZ,WAAY,oBAAUvB,KAAV,CAAiB,iBAC3B,GAAIkG,MAAO,KAAK1H,GAAL,CAAS,KAAT,CAAX,CACA,GAAI2H,KAAMC,SAASC,IAAnB,CACA,GAAIC,WAAYF,SAASG,MAAzB,CAEAtJ,EAAEuJ,IAAF,CAAO,CACLL,IAAK/E,OAAOC,QADP,CAEL6E,KAAM,CAACO,MAAOP,IAAR,CAFD,CAGLQ,OAAQ,MAHH,CAILC,QAAS,iBAACC,QAAD,CAAc,CACrB,GAAIC,cAAe/H,KAAKC,KAAL,CAAW6H,QAAX,CAAnB,CACA,GAAIE,SAAUD,aAAaC,OAA3B,CAEA,GAAIR,UAAU9F,OAAV,CAAkB,SAAlB,GAAgC,CAApC,CAAuC,CACrC,GAAIuG,WAAY,GAAIC,IAAJ,CAAQb,GAAR,CAAhB,CACAY,UAAUE,YAAV,CAAuBC,MAAvB,CAA8B,SAA9B,EACAf,IAAMY,UAAUV,IACjB,CAED,OAAKc,aAAL,IAAwBhB,GAAxB,EAA8BG,UAAUrH,MAAV,CAAmB,CAAnB,CAAuB,GAAvB,CAA6B,GAA3D,aAAyE6H,OAAzE,CAEA7J,EAAE,iBAAF,EAAqBqC,MAArB,sEACArC,EAAE,iBAAF,EAAqBqC,MAArB,yBAAoD,OAAK6H,aAAzD,SACAlK,EAAE,iBAAF,EAAqBqC,MAArB,CAA4B,kFAA5B,CACD,CAnBI,CAoBL8H,MAAO,gBAAM,CACXnK,EAAE,iBAAF,EAAqB4G,IAArB,CAA0B,wFAA1B,CACD,CAtBI,CAAP,CAwBD,CAjSyB,CAmS1BrC,kBAAmB,4BAAY,CAC7B,GAAI,CAAC,KAAK2F,aAAV,CAAyB,CACvB,MACD,CAED,GAAIhB,KAAS/E,OAAOC,QAAhB,SAAJ,CACA,GAAIgG,OAAQC,OAAO,iCAAP,CAAoC,qBAApC,CAAZ,CAEA,GAAI,CAACD,KAAL,CAAY,CACV,MACD,CAED,GAAInB,MAAO,CACTmB,MAAOA,KADE,CAEThG,SAAU,KAAK8F,aAFN,CAAX,CAKA,KAAKI,UAAL,CAAgBpB,GAAhB,CAAqBD,IAArB,CACD,CArTyB,CAuT1BqB,WAAY,oBAAUpB,GAAV,CAAeqB,SAAf,CAA0B,CACpCvK,EAAEuJ,IAAF,CAAO,CACLE,OAAQ,MADH,CAELP,IAAKA,GAFA,CAGLD,KAAMsB,SAHD,CAILb,QAAS,iBAACC,QAAD,CAAc,CACrBa,MAAM,gCAAN,CACD,CANI,CAOLL,MAAO,gBAAM,CACXK,MAAM,wDAAN,CACD,CATI,CAAP,CAWD,CAnUyB,CAqU1B7F,cAAe,uBAAU5B,KAAV,CAAiB,iBAC9BA,MAAMC,cAAN,GACA,GAAIhD,EAAEyK,UAAF,CAAa,KAAKvK,OAAL,CAAawK,gBAA1B,CAAJ,CAAiD,CAC/C,KAAKxK,OAAL,CAAawK,gBAAb,EACD,CAED,GAAIzB,MAAO,KAAK1H,GAAL,CAAS,KAAT,CAAX,CAEAvB,EAAEuJ,IAAF,CAAO,CACLL,IAAK,KAAK5I,OAAL,CAAaC,IAAb,CAAkB,aAAlB,GAAoC,YADpC,CAEL0I,KAAMA,IAFD,CAGLQ,OAAQ,MAHH,CAILC,QAAS,iBAACC,QAAD,CAAc,CACrB,GAAI3J,EAAEyK,UAAF,CAAa,OAAKvK,OAAL,CAAayK,aAA1B,CAAJ,CAA8C,CAC5C,OAAKzK,OAAL,CAAayK,aAAb,CAA2BhB,QAA3B,CACD,CAFD,IAEO,CACLiB,QAAQJ,KAAR,CAAc,CACZK,QAAS,wEADG,CAEZC,SAAU,IAFE,CAGZzH,SAAU,mBAAU,CAClBc,OAAOgF,QAAP,CAAgB4B,MAAhB,CAAuB,IAAvB,CACD,CALW,CAAd,CAOD,CACF,CAhBI,CAiBLZ,MAAO,eAACa,KAAD,CAAQC,UAAR,CAAuB,CAC5B,GAAIC,cAAeD,WAAaD,MAAMG,YAAN,EAAsBH,MAAMI,UAA5B,EAA0CH,UAAvD,CAAoE,IAAvF,CACA,GAAIjL,EAAEyK,UAAF,CAAa,OAAKvK,OAAL,CAAamL,WAA1B,CAAJ,CAA4C,CAC1C,OAAKnL,OAAL,CAAamL,WAAb,CAAyBH,YAAzB,CAAuCF,KAAvC,CACD,CAFD,IAEO,CACLhL,EAAE,OAAF,EACGkB,QADH,CACY,8BADZ,EAEG0F,IAFH,CAEQ,wCAAoCsE,YAF5C,EAGG5I,QAHH,CAGY+B,SAASiH,IAHrB,CAID,CACF,CA3BI,CAAP,CA6BD,CA1WyB,CAA5B,EA8WAtL,EAAEC,MAAF,CAAS,mBAAT,CAA8B,CAE5BG,QAAU,kBAAW,iBACnB,KAAKmL,QAAL,CAAgB,KAAKjL,OAAL,CAAamB,IAAb,CAAkB,sBAAlB,EAA0C+J,KAA1C,EAAhB,CACA,KAAKlL,OAAL,CAAac,EAAb,CAAgB,OAAhB,CAAyB,gBAAzB,CAA2CpB,EAAEW,KAAF,CAAQ,KAAK8K,mBAAb,CAAkC,IAAlC,CAA3C,EACA,KAAKnL,OAAL,CAAac,EAAb,CAAgB,OAAhB,CAAyB,cAAzB,CAAyCpB,EAAEW,KAAF,CAAQ,KAAK+K,kBAAb,CAAiC,IAAjC,CAAzC,EACA,KAAKpL,OAAL,CAAac,EAAb,CAAgB,QAAhB,CAA0B,OAA1B,CAAmCpB,EAAEW,KAAF,CAAQ,KAAKgL,cAAb,CAA6B,IAA7B,CAAnC,EACA,KAAKrL,OAAL,CAAac,EAAb,CAAgB,QAAhB,CAA0B,oCAA1B,CAAgEpB,EAAEW,KAAF,CAAQ,KAAKiL,mBAAb,CAAkC,IAAlC,CAAhE,EACA,KAAKtL,OAAL,CAAac,EAAb,CAAgB,OAAhB,CAAyB,qCAAzB,CAAgEpB,EAAEW,KAAF,CAAQ,KAAKkL,iBAAb,CAAgC,IAAhC,CAAhE,EAEA,GAAI,KAAKvL,OAAL,CAAamB,IAAb,CAAkB,+BAAlB,EAAmDO,MAAvD,CAA+D,CAC7D,KAAK1B,OAAL,CAAamB,IAAb,CAAkB,OAAlB,EAA2BA,IAA3B,CAAgC,mBAAhC,EACGqK,IADH,CACQ,cADR,CAED,CAHD,IAGO,CACL,KAAKxL,OAAL,CAAamB,IAAb,CAAkB,OAAlB,EAA2BA,IAA3B,CAAgC,IAAhC,EACGqK,IADH,CACQ,QADR,CAED,CAED,GAAI,KAAKxL,OAAL,CAAaC,IAAb,CAAkB,gBAAlB,CAAJ,CAAyC,CACvC,KAAKD,OAAL,CAAamB,IAAb,CAAkB,OAAlB,EAA2BsK,QAA3B,CAAoC,CAClCC,OAAQ,cAD0B,CAElCC,KAAM,cAAClJ,KAAD,CAAQG,EAAR,CAAe,CACnB,OAAKgJ,QAAL,EACD,CAJiC,CAApC,CAMD,CAED,KAAK5L,OAAL,CAAamB,IAAb,CAAkB,UAAlB,EAA8BsD,IAA9B,CAAmC/E,EAAEW,KAAF,CAAQ,SAAU6B,KAAV,CAAiB2J,GAAjB,CAAsB,CAC/D,KAAKC,gBAAL,CAAsBD,GAAtB,CACD,CAFkC,CAEhC,IAFgC,CAAnC,EAIA,KAAKD,QAAL,GACA,KAAK5K,WAAL,EACD,CAjC2B,CAmC5B+K,cAAe,wBAAY,CACzB,KAAK/L,OAAL,CAAamB,IAAb,CAAkB,OAAlB,EAA2BoB,KAA3B,EACD,CArC2B,CAuC5B;;;;;OAMAyJ,OAAQ,gBAAUrD,IAAV,CAAgB,CACtB,MAAO,MAAKsD,OAAL,CAAatD,IAAb,CACR,CA/C2B,CAiD5BuD,aAAc,sBAAUC,UAAV,CAAsBC,QAAtB,CAAgCxK,KAAhC,CAAuC,CACnD,GAAMiK,KAAM,KAAK7L,OAAL,CAAamB,IAAb,0BAA0CiL,SAAW,CAArD,MAAZ,CACA,GAAMC,MAAOR,IAAI1K,IAAJ,yBAAiCgL,UAAjC,MAAb,CACA,KAAKG,aAAL,CAAmBD,IAAnB,CAAyBzK,KAAzB,EACA,KAAKgK,QAAL,EACD,CAtD2B,CAwD5B5K,YAAa,sBAAY,iBACvB,GAAMM,YAAa,KAAKtB,OAAL,CAAaC,IAAb,CAAkB,aAAlB,CAAnB,CAEA,GAAIqB,UAAJ,CAAgB,CACd,KAAKyK,aAAL,GAEA,GAAMQ,UAAWhL,KAAKC,KAAL,CAAWF,UAAX,CAAjB,CACAiL,SAASC,OAAT,CAAiB,SAACC,OAAD,CAAa,CAC5B,OAAKT,MAAL,CAAYS,OAAZ,CACD,CAFD,CAGD,CACF,CAnE2B,CAqE5BX,iBAAkB,0BAASD,GAAT,CAAc,CAC9BnM,EAAEmM,GAAF,EAAO1K,IAAP,CAAY,kCAAZ,EAAgDsD,IAAhD,CAAqD/E,EAAEW,KAAF,CAAQ,SAAU6B,KAAV,CAAiB9B,MAAjB,CAAyB,CACpF,KAAKsM,kBAAL,CAAwBhN,EAAEU,MAAF,CAAxB,CACD,CAFoD,CAElD,IAFkD,CAArD,EAIAV,EAAEmM,GAAF,EAAO1K,IAAP,CAAY,+BAAZ,EAA6CsD,IAA7C,CAAkD/E,EAAEW,KAAF,CAAQ,SAAU6B,KAAV,CAAiBY,KAAjB,CAAwB,CAChF+C,cAAcC,gBAAd,CAA+BhD,KAA/B,CACD,CAFiD,CAE/C,IAF+C,CAAlD,EAIApD,EAAEmM,GAAF,EAAO1K,IAAP,CAAY,+BAAZ,EAA6CsD,IAA7C,CAAkD/E,EAAEW,KAAF,CAAQ,SAAU6B,KAAV,CAAiBY,KAAjB,CAAwB,CAChF+C,cAAcE,gBAAd,CAA+BjD,KAA/B,CACD,CAFiD,CAE/C,IAF+C,CAAlD,EAIApD,EAAEmM,GAAF,EAAO1K,IAAP,CAAY,iCAAZ,EAA+CsD,IAA/C,CAAoD/E,EAAEW,KAAF,CAAQ,SAAU6B,KAAV,CAAiBY,KAAjB,CAAwB,CAClFpD,EAAEoD,KAAF,EAAS0D,oBAAT,EACD,CAFmD,CAEjD,IAFiD,CAApD,EAIA,GAAI,KAAK5G,OAAL,CAAa+M,eAAjB,CAAkC,CAChC,KAAK/M,OAAL,CAAa+M,eAAb,CAA6Bd,GAA7B,CACD,CACF,CAzF2B,CA2F5BI,QAAS,iBAAUtD,IAAV,CAAgB,CACvB,GAAMiE,WAAY,KAAK3B,QAAL,CAAcC,KAAd,EAAlB,CACA0B,UAAU5K,QAAV,CAAmB,KAAKhC,OAAL,CAAamB,IAAb,CAAkB,OAAlB,CAAnB,EACAyL,UAAUzL,IAAV,CAAe,cAAf,EAA+BsD,IAA/B,CAAoC/E,EAAEW,KAAF,CAAQ,SAAU6B,KAAV,CAAiBY,KAAjB,CAAwB,CAClE,GAAMqJ,YAAazM,EAAEoD,KAAF,EAAST,OAAT,CAAiB,IAAjB,EAAuBpC,IAAvB,CAA4B,kBAA5B,CAAnB,CACAP,EAAEoD,KAAF,EAAS7B,GAAT,CAAa0H,KAAOA,KAAKwD,UAAL,CAAP,CAA0B,EAAvC,CACD,CAHmC,CAGjC,IAHiC,CAApC,EAKA,KAAKL,gBAAL,CAAsBc,SAAtB,EACA,KAAKhB,QAAL,GAEA,MAAOgB,UACR,CAvG2B,CAyG5BhB,SAAU,mBAAY,CACpB,GAAIiB,OAAQ,EAAZ,CAEA,KAAK7M,OAAL,CAAamB,IAAb,CAAkB,qCAAlB,EAAyDsD,IAAzD,CAA8D/E,EAAEW,KAAF,CAAQ,SAAU+L,QAAV,CAAoBP,GAApB,CAAyB,CAC7F,GAAIiB,KAAM,CAAV,CACA,GAAIC,aAAcrN,EAAEmM,GAAF,EAAO3J,KAAP,EAAlB,CAEA,KAAKlC,OAAL,CAAamB,IAAb,CAAkB,yBAA2B4L,YAAc,CAAzC,EAA8C,IAAhE,EAAsEtI,IAAtE,CAA2E,SAAUvC,KAAV,CAAiB8K,MAAjB,CAAyB,CAClG,GAAIpL,OAAQlC,EAAEsN,MAAF,EAAU7L,IAAV,CAAe,OAAf,EAAwBF,GAAxB,EAAZ,CACA,GAAIW,KAAJ,CAAW,CACTkL,KAAOG,WAAWrL,KAAX,CACR,CACF,CALD,EAOA,KAAK5B,OAAL,CAAamB,IAAb,CAAkB,yBAA2B4L,YAAc,CAAzC,EAA8C,SAAhE,EAA2EzG,IAA3E,CAAgFwG,GAAhF,CACD,CAZ6D,CAY3D,IAZ2D,CAA9D,EAcA,KAAK9M,OAAL,CAAamB,IAAb,CAAkB,UAAlB,EAA8BsD,IAA9B,CAAmC/E,EAAEW,KAAF,CAAQ,SAAU6M,QAAV,CAAoBrB,GAApB,CAAyB,CAClE,GAAIU,UAAW,EAAf,CAEA7M,EAAEmM,GAAF,EAAO1K,IAAP,CAAY,IAAZ,EAAkBsD,IAAlB,CAAuB/E,EAAEW,KAAF,CAAQ,SAAU6B,KAAV,CAAiBmK,IAAjB,CAAuB,CACpD,GAAIzK,OAAQ,KAAKuL,aAAL,CAAmBd,IAAnB,CAAZ,CACA,GAAIF,YAAazM,EAAE2M,IAAF,EAAQpM,IAAR,CAAa,kBAAb,CAAjB,CACAsM,SAASJ,UAAT,EAAuBvK,KACxB,CAJsB,CAIpB,IAJoB,CAAvB,EAMAiL,MAAMjG,IAAN,CAAW2F,QAAX,CACD,CAVkC,CAUhC,IAVgC,CAAnC,EAYA,KAAKvM,OAAL,CAAamB,IAAb,CAAkB,eAAiB,KAAKnB,OAAL,CAAaC,IAAb,CAAkB,iBAAlB,CAAjB,CAAwD,IAA1E,EAAgFgB,GAAhF,CAAoFM,KAAK6L,SAAL,CAAeP,KAAf,CAApF,CACD,CAvI2B,CAyI5BH,mBAAoB,4BAAUW,UAAV,CAAsB,CACxC,GAAIC,OAAQ,CAAC,CAAC5N,EAAE2N,UAAF,EAAclM,IAAd,CAAmB,gBAAnB,EAAqClB,IAArC,CAA0C,YAA1C,CAAd,CACA,GAAIqN,KAAJ,CAAW,CACT5N,EAAE,SAAF,EACGkB,QADH,CACY,yBADZ,EAEG2M,GAFH,CAEO,CAAC,QAAS,KAAV,CAAiB,UAAW,QAA5B,CAFP,EAGG1M,WAHH,CAGewM,UAHf,EAIEA,WAAWE,GAAX,CAAe,CAAC,QAAS,iBAAV,CAA6B,UAAW,QAAxC,CAAkD,eAAgB,KAAlE,CAAf,CACH,CAND,IAMO,CACLF,WAAWG,MAAX,GAAoBrM,IAApB,CAAyB,aAAzB,EAAwCC,MAAxC,GACAiM,WAAWE,GAAX,CAAe,CAAC,QAAS,MAAV,CAAkB,UAAW,OAA7B,CAAf,CACD,CACF,CArJ2B,CAuJ5BJ,cAAe,uBAAUd,IAAV,CAAgB,CAC7B,GAAMoB,YAAa/N,EAAE2M,IAAF,EAAQpM,IAAR,CAAa,kBAAb,CAAnB,CAEA,OAAQwN,UAAR,EACE,IAAK,MAAL,CACE,GAAIC,QAAShO,EAAE2M,IAAF,EAAQlL,IAAR,CAAa,gBAAb,CAAb,CACA,GAAIuM,OAAOzN,IAAP,CAAY,YAAZ,CAAJ,CAA+B,CAC7B,MAAOyN,QAAOpH,IAAP,GAAgB,GAAhB,CAAsB5G,EAAE2M,IAAF,EAAQlL,IAAR,CAAa,kBAAb,EAAiCF,GAAjC,EAC9B,CAFD,IAEO,CACL,GAAIW,OAAQ8L,OAAOzN,IAAP,CAAY,OAAZ,CAAZ,CACA,GAAI2B,KAAJ,CAAW,CACT,MAAOA,MACR,CAED,MAAO8L,QAAOpH,IAAP,EACR,CACH,MACA,IAAK,cAAL,CACE,MAAO5G,GAAE2M,IAAF,EAAQlL,IAAR,CAAa,iCAAb,EAAgDqF,oBAAhD,CAAqE,KAArE,EAA4E5E,KAAnF,CACF,QACE,MAAOlC,GAAE2M,IAAF,EAAQlL,IAAR,CAAa,OAAb,EAAsBF,GAAtB,EAAP,CACF,MAlBF,CAqBA,MAAO,KACR,CAhL2B,CAkL5BqL,cAAe,uBAAUD,IAAV,CAAgBzK,KAAhB,CAAuB,CACpC,GAAM6L,YAAa/N,EAAE2M,IAAF,EAAQpM,IAAR,CAAa,kBAAb,CAAnB,CAEA,OAAQwN,UAAR,EACE,IAAK,cAAL,CACE/N,EAAE2M,IAAF,EAAQlL,IAAR,CAAa,iCAAb,EAAgDqF,oBAAhD,CAAqE,KAArE,CAA4E,CAC1E5E,MAAOA,KADmE,CAA5E,EAGF,MACA,QACElC,EAAE2M,IAAF,EAAQlL,IAAR,CAAa,OAAb,EAAsBF,GAAtB,CAA0BW,KAA1B,EACF,MARF,CAUD,CA/L2B,CAiM5B+L,wBAAyB,kCAAY,CACnC,GAAIC,cAAelO,EAAEuC,GAAF,CAAM,KAAKjC,OAAL,CAAamB,IAAb,CAAkB,aAAlB,CAAN,CAAwC,SAAU0M,EAAV,CAAc,CACvE,MAAO,CACLvH,KAAM5G,EAAEmO,EAAF,EAAMvH,IAAN,EADD,CAELwH,MAAO,aAFF,CAIR,CALkB,CAAnB,CAOA,GAAIC,aAAc,CAAC,GAAD,CAAlB,CACA,IAAK,GAAItM,GAAI,CAAb,CAAgBA,EAAImM,aAAalM,MAAjC,CAAyCD,GAAzC,CAA8C,CAC5CsM,YAAYnH,IAAZ,CAAiB,MAAjB,CACD,CAED,GAAIoH,WAAY,CAAEJ,YAAF,CAAhB,CAEA,KAAK5N,OAAL,CAAamB,IAAb,CAAkB,UAAlB,EAA8BsD,IAA9B,CAAmC/E,EAAEW,KAAF,CAAQ,SAAU+L,QAAV,CAAoB6B,EAApB,CAAwB,CACjE,GAAIpC,KAAM,EAAV,CAEAnM,EAAEuO,EAAF,EAAM9M,IAAN,CAAW,IAAX,EAAiBsD,IAAjB,CAAsB/E,EAAEW,KAAF,CAAQ,SAAU6N,SAAV,CAAqB7B,IAArB,CAA2B,CACvD,GAAIzK,OAAQ,KAAKuL,aAAL,CAAmBd,IAAnB,CAAZ,CACAR,IAAIjF,IAAJ,CAAS,CACPN,KAAM1E,OAAO,EADN,CAAT,CAGD,CALqB,CAKnB,IALmB,CAAtB,EAOAoM,UAAUpH,IAAV,CAAeiF,GAAf,CACD,CAXkC,CAWhC,IAXgC,CAAnC,EAaA,KAAK7L,OAAL,CAAamB,IAAb,CAAkB,UAAlB,EAA8BsD,IAA9B,CAAmC,SAAU2H,QAAV,CAAoB6B,EAApB,CAAwB,CACzD,GAAIpC,KAAM,EAAV,CAEAnM,EAAEuO,EAAF,EAAM9M,IAAN,CAAW,IAAX,EAAiBsD,IAAjB,CAAsB,SAAUyJ,SAAV,CAAqB7B,IAArB,CAA2B,CAC/C,GAAIzK,OAAQlC,EAAE2M,IAAF,EAAQ/F,IAAR,EAAZ,CACAuF,IAAIjF,IAAJ,CAAS,CACPN,KAAM1E,OAAO,EADN,CAEPkM,MAAO,aAFA,CAAT,CAID,CAND,EAQAE,UAAUpH,IAAV,CAAeiF,GAAf,CACD,CAZD,EAcA,MAAO,CACLsC,QAAS,CAAC,CACR7H,KAAM,KAAKtG,OAAL,CAAaC,IAAb,CAAkB,kBAAlB,GAAuC,EADrC,CAER6N,MAAO,QAFC,CAAD,CAGN,CACDM,MAAO,CACLpD,KAAMgD,SADD,CAELK,OAAQN,WAFH,CADN,CAHM,CADJ,CAULO,OAAQ,CACNC,OAAQ,CACNC,SAAU,EADJ,CAENC,KAAM,IAFA,CAGNC,aAAc,EAHR,CADF,CAMNC,YAAa,CACXF,KAAM,IADK,CANP,CASNG,YAAa,CACXH,KAAM,IADK,CATP,CAVH,CAwBR,CAnQ2B,CAqQ5BrD,mBAAoB,4BAAU3I,KAAV,CAAiB,CACnCA,MAAMC,cAAN,GAEA,GAAImM,eAAgB,KAAKlB,uBAAL,EAApB,CAEAmB,QAAQC,SAAR,CAAkBF,aAAlB,EACGG,QADH,CACY,KAAKhP,OAAL,CAAaC,IAAb,CAAkB,iBAAlB,EAAuC,MADnD,CAED,CA5Q2B,CA8Q5BkL,oBAAqB,6BAAU1I,KAAV,CAAiB,CACpCA,MAAMC,cAAN,GACA,KAAKuJ,OAAL,EACD,CAjR2B,CAmR5BZ,eAAgB,wBAAU5I,KAAV,CAAiB,CAC/BA,MAAMC,cAAN,GACA,KAAKkJ,QAAL,EACD,CAtR2B,CAwR5BN,oBAAqB,6BAAU7I,KAAV,CAAiB,CACpC,KAAKiK,kBAAL,CAAwBhN,EAAE+C,MAAME,MAAR,CAAxB,EACA,KAAKiJ,QAAL,EACD,CA3R2B,CA6R5BL,kBAAmB,2BAAU9I,KAAV,CAAiB,CAClC/C,EAAE+C,MAAME,MAAR,EAAgBN,OAAhB,CAAwB,IAAxB,EAA8BjB,MAA9B,GACA,KAAKwK,QAAL,EACD,CAhS2B,CAA9B,EAoSAlM,EAAEC,MAAF,CAAS,kBAAT,CAA6B,CAE3BG,QAAU,kBAAW,CACnB,KAAKmP,UAAL,CAAkB,KAAKjP,OAAL,CAAaC,IAAb,CAAkB,iBAAlB,EAAuC,KAAKD,OAAL,CAAaC,IAAb,CAAkB,iBAAlB,CAAvC,CAA8E,UAAhG,CACA,KAAKiP,WAAL,CAAmB,KAAKlP,OAAL,CAAaC,IAAb,CAAkB,kBAAlB,EAAwC,IAAxC,CAA+C,KAAlE,CACA,KAAKkP,WAAL,CAAmB,KAAKnP,OAAL,CAAaC,IAAb,CAAkB,kBAAlB,EAAwC,IAAxC,CAA+C,KAAlE,CACA,KAAKmP,YAAL,CAAoB,KAAKpP,OAAL,CAAaC,IAAb,CAAkB,oBAAlB,EAA0CoP,SAAS,KAAKrP,OAAL,CAAaC,IAAb,CAAkB,oBAAlB,CAAT,CAA1C,CAA8F,SAAlH,CACA,KAAKD,OAAL,CAAamB,IAAb,CAAkB,kBAAlB,EAAsCL,EAAtC,CAAyC,OAAzC,CAAkDpB,EAAEW,KAAF,CAAQ,KAAKiP,qBAAb,CAAoC,IAApC,CAAlD,EACA,KAAKtP,OAAL,CAAac,EAAb,CAAgB,OAAhB,CAAyB,qBAAzB,CAAgDpB,EAAEW,KAAF,CAAQ,KAAKkP,wBAAb,CAAuC,IAAvC,CAAhD,EAGA,GAAMC,mBAAoB,CACxBC,YAAa,KAAKL,YADM,CAExBM,SAAU,MAFc,CAGxB9G,IAAK,KAAKqG,UAHc,CAIxBU,IAAMjQ,EAAEW,KAAF,CAAQ,KAAKuP,YAAb,CAA2B,IAA3B,CAJkB,CAKxBC,KAAMnQ,EAAEW,KAAF,CAAQ,KAAKyP,aAAb,CAA4B,IAA5B,CALkB,CAMxBC,KAAOrQ,EAAEW,KAAF,CAAQ,KAAK2P,aAAb,CAA4B,IAA5B,CANiB,CAOxBC,YAAcvQ,EAAEW,KAAF,CAAQ,KAAK6P,cAAb,CAA6B,IAA7B,CAPU,CAA1B,CAUA,GAAI,KAAKf,WAAT,CAAsB,CACpBK,kBAAkBW,eAAlB,CAAoC,0BACrC,CAED,KAAKnQ,OAAL,CAAamB,IAAb,CAAkB,eAAlB,EAAmCkG,IAAnC,GACA,KAAKrH,OAAL,CAAamB,IAAb,CAAkB,oBAAlB,EACGoM,GADH,CACO,CACH6C,QAAS,CADN,CADP,EAIGC,UAJH,CAIcb,iBAJd,CAKD,CA/B0B,CAiC3BF,sBAAuB,+BAAU7M,KAAV,CAAiB,CACrCA,MAAMC,cAAN,GAEA,KAAK1C,OAAL,CAAamB,IAAb,CAAkB,eAAlB,EACGiH,IADH,GAEGkI,WAFH,CAEe,YAFf,EAGG1P,QAHH,CAGY,4CAHZ,EAIG2M,GAJH,CAIO,CACH,QAAS,IADN,CAJP,EAQA,KAAKvN,OAAL,CAAamB,IAAb,CAAkB,oBAAlB,EAAwC,CAAxC,EAA2CoP,KAA3C,EACF,CA7C0B,CA+C3BX,aAAc,sBAAUnN,KAAV,CAAiBkG,IAAjB,CAAuB,CACnC,KAAK3I,OAAL,CAAamB,IAAb,CAAkB,kBAAlB,EACGlB,IADH,CACQ,UADR,CACoB,UADpB,EAEGuQ,IAFH,CAEQ,UAFR,CAEoB,IAFpB,EAGG5P,QAHH,CAGY,UAHZ,EAKA+H,KAAKlD,MAAL,EACD,CAtD0B,CAwD3BqK,cAAe,uBAAUrN,KAAV,CAAiBkG,IAAjB,CAAuB,CACpC,GAAM8H,cAAe/Q,EAAE,OAAF,EACjBkB,QADiB,CACR,8BADQ,EAEjB0F,IAFiB,CAEZ,kEAFY,EAGjBtE,QAHiB,CAGR+B,SAASiH,IAHD,CAArB,CAKA,KAAKhL,OAAL,CAAamB,IAAb,CAAkB,kBAAlB,EACGyD,UADH,CACc,UADd,EAEG4L,IAFH,CAEQ,UAFR,CAEoB,KAFpB,EAGGF,WAHH,CAGe,UAHf,EAKAI,WAAW,UAAM,CACfD,aAAarP,MAAb,EACD,CAFD,CAEG,IAFH,CAGD,CAtE0B,CAwE3B4O,cAAe,uBAAUvN,KAAV,CAAiBkG,IAAjB,CAAuB,CACpC,GAAI,KAAKuG,WAAT,CAAsB,CACpB,KAAKlP,OAAL,CAAamB,IAAb,CAAkB,qBAAlB,EAAyCoP,KAAzC,EACD,CAED,KAAKvQ,OAAL,CAAamB,IAAb,CAAkB,kBAAlB,EACGyD,UADH,CACc,UADd,EAEG4L,IAFH,CAEQ,UAFR,CAEoB,KAFpB,EAGGF,WAHH,CAGe,UAHf,EAKA,KAAKtQ,OAAL,CAAamB,IAAb,CAAkB,eAAlB,EACGmP,WADH,CACe,4CADf,EAEG1P,QAFH,CAEY,YAFZ,EAGG2M,GAHH,CAGO,CACH,QAAS,MADN,CAHP,EAOA7N,EAAE+E,IAAF,CAAOkE,KAAKgI,MAAZ,CAAoBjR,EAAEW,KAAF,CAAQ,SAAU6B,KAAV,CAAiB0O,IAAjB,CAAuB,CACjD,GAAMC,QAASD,KAAKE,GAAL,EAAYF,KAAKG,QAAjB,EAA6BH,KAAKI,QAAjD,CACA,GAAMC,SAAUL,KAAKhI,GAAL,EAAY,KAAKqG,UAAL,CAAkB4B,MAA9C,CACA,GAAMK,WAAYN,KAAKM,SAAL,EAAkB,EAApC,CACA,GAAMC,WAAYP,KAAKO,SAAL,EAAkB,EAApC,CACA,GAAMC,cAAeR,KAAKS,YAA1B,CACA,GAAMC,WAAY,KAAKtR,OAAL,CAAaC,IAAb,CAAkB,iBAAlB,CAAlB,CAEA,GAAM4L,KAAMnM,EAAE,OAAF,EACTkB,QADS,CACA,UADA,EAEToB,QAFS,CAEA,KAAKhC,OAAL,CAAamB,IAAb,CAAkB,QAAlB,CAFA,CAAZ,CAIA,GAAMkL,MAAO3M,EAAE,OAAF,EACVkB,QADU,CACD,QADC,EAEVoB,QAFU,CAED6J,GAFC,CAAb,CAIAnM,EAAE,SAAF,EACGO,IADH,CACQ,CACJ,OAAQ,QADJ,CAEJ,OAAQqR,SAFJ,CAGJ,QAAST,MAHL,CADR,EAMG7O,QANH,CAMYqK,IANZ,EAQA3M,EAAE,KAAF,EACGO,IADH,CACQ,CACJ,OAAQgR,OADJ,CAEJ,SAAU,OAFN,CADR,EAKG3K,IALH,CAKQ8K,YALR,EAMGpP,QANH,CAMYqK,IANZ,EAQA3M,EAAE,UAAF,EACGkB,QADH,CACY,sDADZ,EAEGX,IAFH,CAEQ,SAFR,CAEmB4Q,MAFnB,EAGG5Q,IAHH,CAGQ,iBAHR,CAG2BkR,SAH3B,EAIGlR,IAJH,CAIQ,iBAJR,CAI2BiR,SAJ3B,EAKG5K,IALH,CAKQ,QALR,EAMGtE,QANH,CAMYqK,IANZ,EAQA3M,EAAE,KAAKM,OAAP,EAAgBgI,OAAhB,CAAwB,qBAAxB,CAED,CA1CmB,CA0CjB,IA1CiB,CAApB,CA2CD,CApI0B,CAsI3BkI,eAAgB,wBAAUzN,KAAV,CAAiBkG,IAAjB,CAAuB,CACrC,GAAI4I,UAAWlC,SAAS1G,KAAK6I,MAAL,CAAc7I,KAAK8I,KAAnB,CAA2B,GAApC,CAAyC,EAAzC,CAAf,CACA,KAAKzR,OAAL,CAAamB,IAAb,CAAkB,eAAlB,EACGoM,GADH,CACO,CACH,QAASgE,SAAW,GADjB,CADP,CAID,CA5I0B,CA8I3BhC,yBAA0B,kCAAU9M,KAAV,CAAiB,CACzCA,MAAMC,cAAN,GACA,GAAMgP,QAAShS,EAAE+C,MAAME,MAAR,EAAgBN,OAAhB,CAAwB,qBAAxB,CAAf,CACA,GAAMwO,QAASa,OAAOzR,IAAP,CAAY,SAAZ,CAAf,CACA,GAAMkR,WAAYO,OAAOzR,IAAP,CAAY,iBAAZ,CAAlB,CACA,GAAMiR,WAAYQ,OAAOzR,IAAP,CAAY,iBAAZ,CAAlB,CAEA,GAAI2I,KAAM,IAAV,CAEA,GAAIsI,SAAJ,CAAe,CACbtI,IAAMsI,SACP,CAFD,IAEO,CACLtI,IAAM,KAAKqG,UAAL,CAAkB4B,MAAxB,CACA,GAAIM,WAAaA,UAAUzP,MAAV,CAAmB,CAApC,CAAuC,CACrCkH,KAAO,MAAQuI,SAChB,CACF,CAEDzR,EAAEuJ,IAAF,CAAO,CACLL,IAAKA,GADA,CAELO,OAAQ,QAFH,CAGLC,QAAS1J,EAAEW,KAAF,CAAQ,SAASsR,GAAT,CAAc,CAC7BjS,EAAEgS,MAAF,EAAUrP,OAAV,CAAkB,OAAlB,EAA2BjB,MAA3B,GACA1B,EAAE,KAAKM,OAAP,EAAgBgI,OAAhB,CAAwB,uBAAxB,CACD,CAHQ,CAGN,IAHM,CAHJ,CAAP,CAQD,CAxK0B,CAA7B,EA2KAtI,EAAEqE,QAAF,EAAY6N,KAAZ,CAAkB,UAAY,CAC5B,GAAK,MAAOtN,UAAR,GAAuB,WAA3B,CAAwC,CACtC4F,MAAM,yBAAN,CACD,CAEDxK,EAAE,eAAF,EAAmBmS,QAAnB,EACD,CAND,CAQD,CAhhCD,EAghCGC,MAhhCH","file":"form.js","sourcesContent":["/*jshint esversion: 6 */\n/* global Modernizr, pdfMake, MetaformUtils, hyperform, bootbox */\n(function($) {\n  'use strict';\n\n  $.widget(\"custom.metaformMultivalueAutocomplete\", {\n    options: {\n      customSource: null\n    },\n\n    _create : function() {\n      this._sourceUrl = this.element.attr('data-source-url');\n      this._required = !!this.element.attr('data-required');\n      \n      this.element.autocomplete({\n        select: $.proxy(this._onSelect, this),\n        source: $.proxy(this._onSource, this),\n        change: $.proxy(this._onChange, this)\n      });\n      \n      this._valuesContainer = $('<div>')\n        .addClass('metaform-multivalue-values')\n        .insertAfter(this.element);\n\n      this._valuesContainer.on('click', '.metaform-multivalue-autocomplete-delete', $.proxy(this._onValueRemoveClick, this));\n      \n      this._loadValues();\n    },\n    \n    val: function (values) {\n      this._valuesContainer.find('.metaform-multivalue-autocomplete-item').remove();\n      this._addValues(values);\n    },\n     \n    _loadValues: function () {\n      const valuesAttr = this.element.attr('data-values');\n      \n      if (valuesAttr) {\n        this._addValues(JSON.parse(valuesAttr));\n      }\n    },\n    \n    _addValues: function (values) {\n      if (values) {\n        for (let i = 0; i < values.length; i++) {\n          this._addItem(values[i].value, values[i].label);\n        }\n        \n        this._updateValues();\n      }\n    },\n    \n    _addItem: function (value, label) {\n      $('<span>')\n        .addClass('metaform-multivalue-autocomplete-item')\n        .attr('data-value', value)\n        .attr('data-label', label)\n        .append($('<a>').attr('href', '#').addClass('fa fa-times metaform-multivalue-autocomplete-delete'))\n        .append('&nbsp;')\n        .append(label)\n        .appendTo(this._valuesContainer);\n    },\n    \n    _updateValues: function () {\n      const values = this._valuesContainer.find('.metaform-multivalue-autocomplete-item').map(function (index, element) {\n        return $(element).attr('data-value');\n      }).get();\n      \n      var inputName = this.element.attr('data-name');\n      this.element.closest('.metaform').find('input[name=\"' + inputName + '\"]').val(values.join(','));\n      \n      if (this._required) {\n        var empty = !this.element.closest('.metaform').find('input[name=\"' + inputName + '\"]').val();\n        this.element[0].setCustomValidity(empty ? 'This is a required field' : '');\n      }\n    },\n    \n    _onValueRemoveClick: function (event) {\n      event.preventDefault();\n      $(event.target)\n        .closest('.metaform-multivalue-autocomplete-item')\n        .remove();      \n\n      this._updateValues();\n    },\n      \n    _onSelect: function (event, ui) {\n      event.preventDefault();\n      var item = ui.item;\n      this.element.val('');\n      this._addItem(item.value, item.label);\n      this._updateValues();\n    },\n\n    _onSource: function (input, callback) {\n      if (this.options.customSource) {\n        this.options.customSource(input, callback);\n      } else {\n        var sourceUrl = this._sourceUrl + (this._sourceUrl.indexOf('?') === -1 ? '?q=' + input.term : '&q=' + input.term);\n        $.get(sourceUrl, function(items) {\n          callback($.map(items, function (item) {\n            return { \n              value: item.value,\n              label: item.label\n            }; \n          }));\n        }, \"json\");\n      }\n    },\n    \n    _onChange: function (input, callback) {\n      this.element.val('');\n    }\n  });\n  \n  $.widget(\"custom.metaformAutocomplete\", {\n    options: {\n      customSource: null\n    },\n    \n    _create : function() {\n      this._sourceUrl = this.element.attr('data-source-url');\n      this._selected = false;\n      \n      this.element.on(\"focus\", $.proxy(this._onFocus, this));\n      \n      this.element.autocomplete({\n        select: $.proxy(this._onSelect, this),\n        source: $.proxy(this._onSource, this),\n        change: $.proxy(this._onChange, this)\n      });\n    },\n    \n    val: function (item) {\n      const valueInput = this._getInput();\n      \n      if (item === undefined) {\n        let value = null;\n        if (valueInput.length > 0) {\n          value = valueInput.val();\n        } else {\n          value = this.element.attr('data-value');\n        }\n        return {\n          value: value,\n          label: this.element.val()\n        };\n      } else {\n        this.element.val(item.label);\n        if (valueInput.length > 0) {\n          valueInput.val(item.value);\n        } else {\n          this.element.attr('data-value', item.value);\n        }\n      }\n    },\n    \n    _getInput: function () {\n      var inputName = this.element.attr('data-name');\n      return this.element.closest('.metaform').find('input[name=\"' + inputName + '\"]');\n    },\n    \n    _onFocus: function () {\n      this._originalValue = this._getInput().val();\n      this._originalLabel = this.element.val();\n      this._selected = false;\n    },\n      \n    _onSelect: function (event, ui) {\n      event.preventDefault();\n      var item = ui.item;\n      this.val(item);\n      this._selected = true;\n    },\n\n    _onSource: function (input, callback) {\n      if (this.options.customSource) {\n        this.options.customSource(input, callback);\n      } else {\n        var sourceUrl = this._sourceUrl + (this._sourceUrl.indexOf('?') === -1 ? '?q=' + input.term : '&q=' + input.term);\n        $.get(sourceUrl, function(items) {\n          callback($.map(items, function (item) {\n            return { \n              value: item.value,\n              label: item.label\n            }; \n          }));\n        }, \"json\");\n      }\n    },\n    \n    _onChange: function (input, callback) {\n      if (!this._selected) {\n        this.val({\n          value: this._originalValue, \n          label: this._originalLabel\n        });\n      }\n      \n      this._originalValue = null;\n      this._originalLabel = null;\n      this._selected = false;\n    }\n  });\n\t\n  $.widget(\"custom.metaform\", {\n\n    options: {\n      animation: {\n        framework: 'default'\n      }\n    },\n    \n    _create : function() {\n      window.draftUrl = \"/formDraft\";\n      $(document).on(\"click\", \".metaform-save-draft\", $.proxy(this._saveDraft, this));\n      $(document).on(\"click\", \".send-draft-email\", $.proxy(this._sendDraftToEmail, this));\n\n      this.element.find('.file-component').fileField();\n      this.element.find('.table-field').tableField();\n    \n      this.attachedVisibleIfListeners = [];\n      \n      this.element.on(\"submit\", $.proxy(this._onFormSubmit, this));\n      if (!Modernizr.formvalidation) {\n        hyperform(this.element[0]);\n      }\n      \n      this.element.find('*[data-visible-if]').each(function (index, element) {\n        $(element).find('*[required]').each(function (inputIndex, inputElement) {\n          $(inputElement).removeAttr('required');\n          $(inputElement).attr('data-required', 'required');\n        }.bind(this));\n        \n        var formGroupId = $(element).attr('id');\n        var rule = JSON.parse($(element).attr('data-visible-if'));\n        this._registerVisibleIfRule(formGroupId, rule, rule);\n        this.attachedVisibleIfListeners = [];\n      }.bind(this));\n      \n      this.element.find('input:checked').change();\n      this._createDatePickers();\n      this._createTimePickers();\n      this._createDateTimePickers();\n      this._createAutocompleteFields();\n      this._createReadonlyDateTimes();\n    },\n    \n    val: function (returnArray) {\n      return returnArray ? this.element.serializeArray() : this.element.serialize();\n    },\n    \n    submit: function () {\n      this.element.submit();\n    },\n    \n    addData: function(key, value) {\n      var dataInput = $('<input>')\n        .attr('name', key)\n        .attr('type', 'hidden')\n        .val(value);\n\n      this.element.append(dataInput);\n    },\n    \n    _createDatePickers: function () {\n      this.element.find('input[data-type=\"date\"]').each(function (index, input) {\n        MetaformUtils.createDatePicker(input);\n      });\n    },\n    \n    _createTimePickers: function () {\n      this.element.find('input[data-type=\"time\"]').each(function (index, input) {\n        MetaformUtils.createTimePicker(input);\n      });\n    },\n    \n    _createDateTimePickers: function () {\n      this.element.find('input[data-type=\"date-time\"]').each(function (index, input) {\n        MetaformUtils.createDateTimePicker(input);\n      });\n    },\n\n    _createReadonlyDateTimes: function () {\n      if (typeof moment !== \"function\") {\n        return;\n      }\n\n      const language = window.navigator.userLanguage || window.navigator.language;\n      if (language) {\n        moment.locale(language);\n      }\n\n      this.element.find(\".date-time-readonly\").each(function (index, element) {\n        const value = $(element).text();\n        const format = $(element).attr(\"data-format\");\n        if (value) {\n          $(element).text(moment(value).format(format || \"LLL\"));\n        }\n      });\n    },\n    \n    _createAutocompleteFields: function () {\n      this.element.find('input[data-type=\"autocomplete\"]').metaformAutocomplete();\n      this.element.find('input[data-type=\"autocomplete-multiple\"]').metaformMultivalueAutocomplete();\n    },\n    \n    _registerVisibleIfRule: function (formGroupId, currentRule, rule) {\n      if (typeof(currentRule.field) !== 'undefined' && this.attachedVisibleIfListeners.indexOf(currentRule.field) === -1) {\n        this.attachedVisibleIfListeners.push(currentRule.field);\n        \n        this.element.find('input[name=\"'+currentRule.field+'\"],select[name=\"'+currentRule.field+'\"]')\n          .change($.proxy(this._createFormChangeFunction(formGroupId, rule), this))\n          .keyup($.proxy(this._createFormChangeFunction(formGroupId, rule), this));\n      }\n      \n      if (typeof(currentRule.and) !== 'undefined') {\n        for (var i = 0; i < currentRule.and.length; i++) {\n          var andSubRule = currentRule.and[i];\n          this._registerVisibleIfRule(formGroupId, andSubRule, rule);\n        }\n      }\n      \n      if (typeof(currentRule.or) !== 'undefined') {\n        for (var j = 0; j < currentRule.or.length; j++) {\n          var orSubRule = currentRule.or[j];\n          this._registerVisibleIfRule(formGroupId, orSubRule, rule);\n        }\n      }\n      \n      if (!this._evaluateFormRule(rule)) {\n        this.element.find(`#${formGroupId}`).hide();\n      }\n    },\n    \n    _evaluateFormRule: function(rule) {\n      var equals = false;\n      var analyzed = false;\n      \n      if (typeof(rule.field) !== 'undefined') {\n        var inputElement = this.element.find('input[name=\"'+rule.field+'\"],select[name=\"'+rule.field+'\"]').first();\n        var currentValue = '';\n        var checked = false;\n        \n        if( inputElement.is(':checkbox') || inputElement.is(':radio')) {\n          checked = this.element.find('input[name=\"'+rule.field+'\"]:checked').length > 0;\n          currentValue = this.element.find('input[name=\"'+rule.field+'\"]:checked').val();\n        } else {\n          checked = inputElement.val() ? true : false;\n          currentValue = inputElement.val();\n        }\n\n        analyzed = true;\n        \n        if (rule.equals === true) {\n          equals = checked;\n        } else if (typeof(rule.equals) !== 'undefined') {\n          equals = rule.equals === currentValue;\n        } else if (rule['not-equals'] === true) {\n          equals = !checked;\n        } else if (typeof(rule['not-equals']) !== 'undefined') {\n          equals = rule['not-equals'] !== currentValue;\n        }\n      }\n      \n      if (typeof(rule.and) !== 'undefined') {\n        var andResult = true;\n        for (var i = 0; i < rule.and.length; i++) {\n          var andSubRule = rule.and[i];\n          andResult = andResult && this._evaluateFormRule(andSubRule);\n          if (!andResult) {\n            break;\n          }\n        }\n        equals = analyzed ? equals && andResult : andResult;\n      }\n\n      if (typeof(rule.or) !== 'undefined') {\n        var orResult = false;\n        for (var j = 0; j < rule.or.length; j++) {\n          var orSubRule = rule.or[j];\n          orResult = orResult || this._evaluateFormRule(orSubRule);\n          if (orResult) {\n            break;\n          }\n        }\n        equals = analyzed ? equals || orResult : orResult;\n      }\n      \n      return equals;\n    },\n    \n    _createFormChangeFunction: function(formGroupId, rule) {\n      return function(e) {\n        const formGroup = this.element.find(`#${formGroupId}`);\n        const equals = this._evaluateFormRule(rule);\n\n        if (equals) {\n          this.element.trigger(\"beforeShow\", {\n            target: formGroup\n          });\n        \n          this._show(formGroup, () => {\n            this._onRequiredFieldsVisibilityChange(formGroup, 'SHOW');\n            this.element.trigger(\"afterShow\", {\n              target: formGroup\n            });\n          });\n        } else if(!equals) {\n          this.element.trigger(\"beforeHide\", {\n            target: formGroup\n          });\n        \n          this._hide(formGroup, () => {\n            this._onRequiredFieldsVisibilityChange(formGroup, 'HIDE');\n            this.element.trigger(\"afterHide\", {\n              target: formGroup\n            });\n          });\n        }\n      };\n    },\n\n    _show: function (element, callback) {\n      const show = this.options.animation.show || {};\n      const duration = show.duration || 400;\n      const options = show.options || {};\n      const effect = show.effect || 'slide';\n\n      switch (this.options.animation.framework) {\n        case 'jquery-ui':\n          element.show(effect, options, duration, callback);\n        break;\n        default:\n          element.slideDown(duration, callback);\n        break;\n      }\n    },\n\n    _hide: function (element, callback) {\n      const hide = this.options.animation.hide || {};\n      const duration = hide.duration || 400;\n      const options = hide.options || {};\n      const effect = hide.effect || 'slide';\n\n      switch (this.options.animation.framework) {\n        case 'jquery-ui':\n          element.hide(effect, options, duration, callback);\n        break;\n        default:\n          element.slideUp(duration, callback);\n        break;\n      }\n    },\n\n    _onRequiredFieldsVisibilityChange: function(container, action) {  \n      $(container).find('*[data-required]').each(function (inputIndex, inputElement) {\n        if (action === 'SHOW' && $(inputElement).is(':visible')) {\n          $(inputElement).attr('required', 'required');\n        } else if (action === 'HIDE') {\n          $(inputElement).removeAttr('required');\n        }\n      });\n    },\n\n    _saveDraft: function (event) {\n      var data = this.val(false);\n      var url = location.href;\n      var urlParams = location.search;\n\n      $.ajax({\n        url: window.draftUrl,\n        data: {reply: data},\n        method: 'POST',\n        success: (response) => {\n          var responseJson = JSON.parse(response);\n          var replyId = responseJson.replyId;\n\n          if (urlParams.indexOf(\"replyId\") >= 0) {\n            var urlObject = new URL(url);\n            urlObject.searchParams.delete('replyId');\n            url = urlObject.href;\n          }\n\n          this.drafReplytUrl = `${url}${urlParams.length > 0 ? \"&\" : \"?\"}replyId=${replyId}`;\n\n          $('.draft-response').append(`<p>Käytä allaolevaa linkkiä jatkaaksesi myöhemmin</p>`);\n          $('.draft-response').append(`<p class=\"draft-url\">${this.drafReplytUrl}</p>`);\n          $('.draft-response').append('<button class=\"send-draft-email\">Lähetä linkki sähköpostiin</button>');\n        },\n        error: () => {\n          $('.draft-response').text(\"Tapahtui virhe tallentaessa. Älä poistu sivulta ennen lomakkeen lähetystä.\");\n        }\n      });\n    },\n\n    _sendDraftToEmail: function () {\n      if (!this.drafReplytUrl) {\n        return;\n      }\n\n      var url = `${window.draftUrl}/email`;\n      var email = prompt(\"Anna sähköpostiosoitteesi\", \"esimerkki@domain.fi\");\n\n      if (!email) {\n        return;\n      }\n      \n      var data = {\n        email: email, \n        draftUrl: this.drafReplytUrl\n      };\n\n      this._sendEmail(url, data);\n    },\n\n    _sendEmail: function (url, emailData) {\n      $.ajax({\n        method: 'POST',\n        url: url,\n        data: emailData,\n        success: (response) => {\n          alert(\"Sähköposti lähetetty!\");\n        },\n        error: () => {\n          alert(\"Tapahtui virhe lähettäessä sähköpostia.\");\n        }\n      });\n    },\n\n    _onFormSubmit: function (event) {\n      event.preventDefault();\n      if ($.isFunction(this.options.beforeFormSubmit)) {\n        this.options.beforeFormSubmit();\n      }\n      \n      var data = this.val(false);\n\n      $.ajax({\n        url: this.element.attr('data-action') || '/formReply',\n        data: data,\n        method: 'POST',\n        success: (response) => {\n          if ($.isFunction(this.options.onPostSuccess)) {\n            this.options.onPostSuccess(response);\n          } else {\n            bootbox.alert({\n              message: '<i class=\"fa fa-check\" /><h3>Lomake lähetettiin onnistuneesti.</h3>',\n              backdrop: true,\n              callback: function(){\n                window.location.reload(true);\n              }\n            });\n          }\n        },\n        error: (jqXHR, textStatus) => {\n          var errorMessage = textStatus ? jqXHR.responseText || jqXHR.statusText || textStatus : null;\n          if ($.isFunction(this.options.onPostError)) {\n            this.options.onPostError(errorMessage, jqXHR);\n          } else {\n            $('<div>')\n              .addClass('alert alert-danger fixed-top')\n              .text('Lomakkeen lähetys epäonnistui: ' + errorMessage)\n              .appendTo(document.body);\n          }\n        }\n      });\n    }\n  \n  });\n  \n  $.widget(\"custom.tableField\", {\n    \n    _create : function() {\n      this.tableRow = this.element.find('tbody tr:first-child').clone();\n      this.element.on('click', '.add-table-row', $.proxy(this._onAddTableRowClick, this));\n      this.element.on('click', '.print-table', $.proxy(this._onPrintTableClick, this));\n      this.element.on('change', 'input', $.proxy(this._onInputChange, this));\n      this.element.on('change', 'td[data-column-type=\"enum\"] select', $.proxy(this._onEnumSelectChange, this));\n      this.element.on('click', 'td button[data-action=\"delete-row\"]', $.proxy(this._onDeleteRowClick, this));\n\n      if (this.element.find('th[data-calculate-sum=\"true\"]').length) {\n        this.element.find('tfoot').find('td:nth-of-type(1)')\n          .html('Yhteensä:');\n      } else {\n        this.element.find('tfoot').find('td')\n          .html('&nbsp;');\n      }\n      \n      if (this.element.attr('data-draggable')) {\n        this.element.find('tbody').sortable({\n          handle: \".sort-handle\",\n          stop: (event, ui) => {\n            this._refresh(); \n          }\n        });\n      }\n      \n      this.element.find('tbody tr').each($.proxy(function (index, row) {\n        this._processTableRow(row);\n      }, this));\n      \n      this._refresh();\n      this._loadValues();\n    },\n    \n    removeAllRows: function () {\n      this.element.find('tbody').empty();\n    },\n    \n    /**\n     * Adds new row to table.\n     * \n     * @param {Object} data object containing name - value pairs of data\n     * @returns {Element} Added row element\n     */\n    addRow: function (data) {\n      return this._addRow(data);\n    },\n    \n    setCellValue: function (columnName, rowIndex, value) {\n      const row = this.element.find(`tbody tr:nth-of-type(${rowIndex + 1})`);\n      const cell = row.find(`td[data-column-name=\"${columnName}\"]`);\n      this._setCellValue(cell, value);\n      this._refresh();\n    },\n    \n    _loadValues: function () {\n      const valuesAttr = this.element.attr('data-values');\n      \n      if (valuesAttr) {\n        this.removeAllRows();\n        \n        const rowDatas = JSON.parse(valuesAttr);\n        rowDatas.forEach((rowData) => {\n          this.addRow(rowData);\n        });\n      }\n    },\n    \n    _processTableRow: function(row) {\n      $(row).find('[data-column-type=\"enum\"] select').each($.proxy(function (index, select) {\n        this._refreshEnumSelect($(select));\n      }, this));\n      \n      $(row).find('input[data-type=\"table-date\"]').each($.proxy(function (index, input) {\n        MetaformUtils.createDatePicker(input);\n      }, this));\n\n      $(row).find('input[data-type=\"table-time\"]').each($.proxy(function (index, input) {\n        MetaformUtils.createTimePicker(input);\n      }, this));\n\n      $(row).find('input[data-type=\"autocomplete\"]').each($.proxy(function (index, input) {\n        $(input).metaformAutocomplete();\n      }, this));\n      \n      if (this.options.afterProcessRow) {\n        this.options.afterProcessRow(row);\n      }\n    },\n    \n    _addRow: function (data) {\n      const clonedRow = this.tableRow.clone();\n      clonedRow.appendTo(this.element.find('tbody'));\n      clonedRow.find('input,select').each($.proxy(function (index, input) {\n        const columnName = $(input).closest('td').attr('data-column-name');\n        $(input).val(data ? data[columnName] : '');\n      }, this));\n      \n      this._processTableRow(clonedRow);\n      this._refresh();\n      \n      return clonedRow;\n    },\n    \n    _refresh: function () {\n      var datas = [];\n      \n      this.element.find('thead th[data-calculate-sum=\"true\"]').each($.proxy(function (rowIndex, row) {\n        var sum = 0;\n        var columnIndex = $(row).index();\n        \n        this.element.find('tbody td:nth-of-type(' + (columnIndex + 1) + ' )').each(function (index, column) {\n          var value = $(column).find('input').val();\n          if (value) {\n            sum += parseFloat(value);\n          }\n        });\n\n        this.element.find('tfoot td:nth-of-type(' + (columnIndex + 1) + ' ) .sum').text(sum);\n      }, this));\n\n      this.element.find('tbody tr').each($.proxy(function (indexRow, row) {\n        var rowDatas = {};\n        \n        $(row).find('td').each($.proxy(function (index, cell) {\n          var value = this._getCellValue(cell);\n          var columnName = $(cell).attr('data-column-name');\n          rowDatas[columnName] = value;\n        }, this));\n        \n        datas.push(rowDatas);\n      }, this));\n      \n      this.element.find('input[name=\"' + this.element.attr('data-field-name') + '\"]').val(JSON.stringify(datas));\n    },\n    \n    _refreshEnumSelect: function (enumSelect) {\n      var other = !!$(enumSelect).find('option:checked').attr('data-other');\n      if (other) {\n        $('<input>')\n          .addClass('enum-other form-control')\n          .css({'width': '50%', 'display': 'inline'})\n          .insertAfter(enumSelect);\n          enumSelect.css({'width': 'calc(50% - 4px)', 'display': 'inline', 'margin-right': '4px'});\n      } else {\n        enumSelect.parent().find('.enum-other').remove();\n        enumSelect.css({'width': '100%', 'display': 'block'});\n      }\n    },\n    \n    _getCellValue: function (cell) {\n      const columnType = $(cell).attr('data-column-type');\n      \n      switch (columnType) {\n        case 'enum':\n          var option = $(cell).find('option:checked');\n          if (option.attr('data-other')) {\n            return option.text() + ' ' + $(cell).find('input.enum-other').val();\n          } else {\n            var value = option.attr('value');\n            if (value) {\n              return value;\n            }\n            \n            return option.text();\n          }\n        break;\n        case 'autocomplete':\n          return $(cell).find('input[data-type=\"autocomplete\"]').metaformAutocomplete('val').value;\n        default:\n          return $(cell).find('input').val();\n        break;\n      }\n      \n      return null;\n    },\n    \n    _setCellValue: function (cell, value) {\n      const columnType = $(cell).attr('data-column-type');\n      \n      switch (columnType) {\n        case 'autocomplete':\n          $(cell).find('input[data-type=\"autocomplete\"]').metaformAutocomplete('val', {\n            value: value\n          });\n        break;\n        default:\n          $(cell).find('input').val(value);\n        break;\n      }\n    },\n    \n    _generatePrintableTable: function () {\n      var tableHeaders = $.map(this.element.find('thead tr th'), function (th) {\n        return {\n          text: $(th).text(),\n          style: 'tableHeader'\n        };\n      });\n      \n      var tableWidths = ['*'];\n      for (var i = 1; i < tableHeaders.length; i++) {\n        tableWidths.push('auto');  \n      }\n      \n      var tableBody = [ tableHeaders ];\n      \n      this.element.find('tbody tr').each($.proxy(function (rowIndex, tr) {\n        var row = [];\n        \n        $(tr).find('td').each($.proxy(function (cellIndex, cell) {\n          var value = this._getCellValue(cell);\n          row.push({\n            text: value||'' \n          });\n        }, this));\n        \n        tableBody.push(row);\n      }, this));\n      \n      this.element.find('tfoot tr').each(function (rowIndex, tr) {\n        var row = [];\n        \n        $(tr).find('td').each(function (cellIndex, cell) {\n          var value = $(cell).text();\n          row.push({\n            text: value||'',\n            style: 'tableFooter'\n          });\n        });\n        \n        tableBody.push(row);\n      });\n      \n      return {\n        content: [{ \n          text: this.element.attr('data-field-title')||'', \n          style: 'header' \n        }, {\n          table: {\n            body: tableBody,\n            widths: tableWidths\n          }\n        }],\n        styles: { \n          header: {\n            fontSize: 18,\n            bold: true,\n            marginBottom: 10\n          },\n          tableHeader: {\n            bold: true\n          },\n          tableFooter: {\n            bold: true\n          }\n        }\n      };\n    },\n    \n    _onPrintTableClick: function (event) {\n      event.preventDefault();\n      \n      var docDefinition = this._generatePrintableTable();\n      \n      pdfMake.createPdf(docDefinition)\n        .download(this.element.attr('data-field-name') + '.pdf');\n    },\n    \n    _onAddTableRowClick: function (event) {\n      event.preventDefault();\n      this._addRow();\n    },\n    \n    _onInputChange: function (event) {\n      event.preventDefault();\n      this._refresh();\n    },\n    \n    _onEnumSelectChange: function (event) {\n      this._refreshEnumSelect($(event.target));\n      this._refresh();\n    },\n    \n    _onDeleteRowClick: function (event) {\n      $(event.target).closest('tr').remove();\n      this._refresh();\n    }\n    \n  });\n\t\n  $.widget(\"custom.fileField\", {\n    \n    _create : function() {\n      this._uploadUrl = this.element.attr('data-upload-url') ? this.element.attr('data-upload-url') : '/upload/';\n      this._singleFile = this.element.attr('data-single-file') ? true : false;\n      this._onlyImages = this.element.attr('data-only-images') ? true : false;\n      this._maxFileSize = this.element.attr('data-max-file-size') ? parseInt(this.element.attr('data-max-file-size')) : 209715200;\n      this.element.find('.add-file-button').on(\"click\", $.proxy(this._onAddFileButtonClick, this));\n      this.element.on('click', '.remove-file-button', $.proxy(this._onRemoveFileButtonClick, this));\n      \n      \n      const fileUploadOptions = {\n        maxFileSize: this._maxFileSize,\n        dataType: 'json',\n        url: this._uploadUrl,\n        add : $.proxy(this._onUploadAdd, this),\n        fail: $.proxy(this._onUploadFail, this),\n        done : $.proxy(this._onUploadDone, this),\n        progressall : $.proxy(this._onProgressAll, this) \n      };\n      \n      if (this._onlyImages) {\n        fileUploadOptions.acceptFileTypes = /(\\.|\\/)(gif|jpe?g|png)$/i;\n      }\n      \n      this.element.find('.progress-bar').hide();\n      this.element.find('input[type=\"file\"]')\n        .css({\n          opacity: 0\n        })\n        .fileupload(fileUploadOptions);\n    },\n    \n    _onAddFileButtonClick: function (event) {\n       event.preventDefault();\n       \n       this.element.find('.progress-bar')\n         .show()\n         .removeClass('bg-success')\n         .addClass('progress-bar-animated progress-bar-striped')\n         .css({\n           'width': '0%'  \n         });\n\n       this.element.find('input[type=\"file\"]')[0].click();\n    },\n\n    _onUploadAdd: function (event, data) {\n      this.element.find('.add-file-button')\n        .attr('disabled', 'disabled')\n        .prop('disabled', true)\n        .addClass('disabled');\n      \n      data.submit();\n    },\n    \n    _onUploadFail: function (event, data) {\n      const notification = $('<div>')\n         .addClass('alert alert-danger fixed-top')\n         .text('Kuvan lähetys epäonnistui. Tarkista koko ja tiedostomuoto.')\n         .appendTo(document.body);\n \n      this.element.find('.add-file-button')\n        .removeAttr('disabled')\n        .prop('disabled', false)\n        .removeClass('disabled');\n\n      setTimeout(() => {\n        notification.remove();\n      }, 5000);\n    },\n    \n    _onUploadDone: function (event, data) {\n      if (this._singleFile) {\n        this.element.find('.remove-file-button').click();\n      }\n      \n      this.element.find('.add-file-button')\n        .removeAttr('disabled')\n        .prop('disabled', false)\n        .removeClass('disabled');\n\n      this.element.find('.progress-bar')\n        .removeClass('progress-bar-animated progress-bar-striped')\n        .addClass('bg-success')\n        .css({\n          'width': '100%'  \n        });\n      \n      $.each(data.result, $.proxy(function (index, file) {\n        const fileId = file._id || file.fileData || file.filename;\n        const fileUrl = file.url || this._uploadUrl + fileId;\n        const deleteUrl = file.deleteUrl || '';\n        const deleteKey = file.deleteKey || '';\n        const originalName = file.originalname;\n        const fieldName = this.element.attr('data-field-name');\n\n        const row = $('<div>')\n          .addClass('file row')\n          .appendTo(this.element.find('.files'));\n        \n        const cell = $('<div>')\n          .addClass('col-12')\n          .appendTo(row);\n        \n        $('<input>')\n          .attr({\n            'type': 'hidden',\n            'name': fieldName,\n            'value': fileId\n          })\n          .appendTo(cell);\n        \n        $('<a>')\n          .attr({\n            'href': fileUrl,\n            'target': 'blank'\n          })\n          .text(originalName)\n          .appendTo(cell);\n       \n        $('<button>')\n          .addClass('remove-file-button btn btn-danger btn-sm float-right')\n          .attr('data-id', fileId)\n          .attr('data-delete-key', deleteKey)\n          .attr('data-delete-url', deleteUrl)\n          .text('Poista')\n          .appendTo(cell);\n        \n        $(this.element).trigger('metaform:file-added');\n        \n      }, this));\n    },\n    \n    _onProgressAll: function (event, data) {\n      var progress = parseInt(data.loaded / data.total * 100, 10);\n      this.element.find('.progress-bar')\n        .css({\n          'width': progress + '%'  \n        });\n    },\n    \n    _onRemoveFileButtonClick: function (event) {\n      event.preventDefault();\n      const button = $(event.target).closest('.remove-file-button');\n      const fileId = button.attr('data-id');\n      const deleteKey = button.attr('data-delete-key');\n      const deleteUrl = button.attr('data-delete-url');\n\n      let url = null;\n\n      if (deleteUrl) {\n        url = deleteUrl;\n      } else {\n        url = this._uploadUrl + fileId;\n        if (deleteKey && deleteKey.length > 0) {\n          url += '?c=' + deleteKey;\n        }\n      }\n      \n      $.ajax({\n        url: url,\n        method: 'DELETE',\n        success: $.proxy(function(res) {\n          $(button).closest('.file').remove();\n          $(this.element).trigger('metaform:file-removed');\n        }, this)\n      });\n    }\n  });\n  \n  $(document).ready(function () {\n    if ((typeof Modernizr) === 'undefined') {\n      alert('Modernizr is not loaded');\n    }\n    \n    $('form.metaform').metaform();\n  });\n  \n})(jQuery);"]}